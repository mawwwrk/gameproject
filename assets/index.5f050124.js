var at=Object.defineProperty;var nt=(e,t,h)=>t in e?at(e,t,{enumerable:!0,configurable:!0,writable:!0,value:h}):e[t]=h;var L=(e,t,h)=>(nt(e,typeof t!="symbol"?t+"":t,h),h),K=(e,t,h)=>{if(!t.has(e))throw TypeError("Cannot "+h)};var y=(e,t,h)=>(K(e,t,"read from private field"),h?h.call(e):t.get(e)),F=(e,t,h)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,h)},Y=(e,t,h,s)=>(K(e,t,"write to private field"),s?s.call(e,h):t.set(e,h),h);import"https://cdn.skypack.dev/normalizecss";const rt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function h(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerpolicy&&(n.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?n.credentials="include":i.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=h(i);fetch(i.href,n)}};rt();let X={toLoad:0,loaded:0,load(e){return new Promise(t=>{const h=()=>{this.loaded+=1,this.toLoad===this.loaded&&(this.toLoad=0,this.loaded=0,t())};this.toLoad=e.length,e.forEach(s=>{const i=s.split(".").pop();i==="json"&&this.loadJson(s,h),["ttf","otf","woff"].indexOf(i)!==-1&&this.loadFont(s,h)})})},loadFont(e,t){let h=e.split("/").pop().split(".")[0],s=document.createElement("style"),i=`@font-face {font-family:'${h}'; src: url(${e});}`;s.appendChild(document.createTextNode(i)),document.head.appendChild(s),t()},async loadJson(e,t){const s=await(await fetch(e)).json();let i=/(?<=\/)\w+\.\w+$/.exec(e)[0];this[i]=s,s.meta.frameTags?this.processFrameTags(i,s,t):s.frames?this.processFrames(s,t):t()},processFrameTags(e,t,h){const s=e.split(".").shift(),i=t.meta.image,n=Object.keys(t.frames),r=()=>{this[i]=a,this[s]={image:this[i],frameTags:{},animationStates:{},animationFrames:[]},(()=>{for(let o of t.meta.frameTags){let{name:f,from:g,to:m}=o;this[s].animationStates[f]=[g,m]}n.forEach(o=>{this[s].animationFrames.push(t.frames[o])})})(),h()};let a=new Image;a.addEventListener("load",r),a.src=i},processFrames(e,t){const h=e.meta.image,s=()=>{this[h]=i,Object.keys(e.frames).forEach(n=>{this[n]=e.frames[n],this[n].source=this[h]}),t()};let i=new Image;i.addEventListener("load",s),i.src=h}};function ot(e){let t=0,h=0,s=0,i=0,n;function r(m){a(),e.showFrame(m)}function a(){e.playing=!1,t=0,s=0,i=0,h=0,clearInterval(n)}function l(){f([0,e.frames.length-1])}function o(){a(),e.showFrame(e._currentFrame)}function f(m){a(),s=m[0],i=m[1],h=i-s,s===0&&(h+=1,t+=1),h===1&&(h=2,t+=1),e.fps||(e.fps=12);let b=1e3/e.fps;e.showFrame(s),e.playing||(n=setInterval(g.bind(this),b),e.playing=!0)}function g(){t<h?(e.showFrame(e._currentFrame+1),t+=1):(e.loop&&(e.showFrame(s),t=1),(this==null?void 0:this.onComplete)&&this.onComplete())}Object.assign(e,{show:r,playAnimation:l,stopAnimation:o,playSequence:f})}let G=0;function lt(e="canvas",t=384,h=384){const s=document.createElement("canvas");return++G,e==="canvas"?s.classList.add(`${e}${G}`):s.id=e,s.width=t,s.height=h,document.body.insertBefore(s,document.querySelectorAll("body > :last-child")[0]),s.ctx=s.getContext("2d"),s}function ft(e,t,h=!1){let s=t.x,i=t.y,n=t.width,r=t.height,a,l=.96,o={};e.hitbox?(o.x=e.hitbox.gx,o.y=e.hitbox.gy,o.width=e.hitbox.width,o.height=e.hitbox.height):(o.x=e.x,o.y=e.y,o.width=e.width,o.height=e.height);let f=e.hitbox?(e.width-e.hitbox.width)/2:0,g=e.hitbox?(e.height-e.hitbox.height)/2:0;return o.x<0&&(h&&(e.vx*=-l),e.mass&&(e.vx/=e.mass),e.x=s-f,a="left"),o.y<i&&(h&&(e.vy*=-l),e.mass&&(e.vy/=e.mass),e.y=i-g,a="top"),o.x+o.width>n&&(h&&(o.vx*=-l),e.mass&&(e.vx/=e.mass),e.x=n-e.width+f,a="right"),o.y+o.height>r&&(h&&(e.vy*=-l),e.mass&&(e.vy/=e.mass),e.y=r-e.height+g,a="bottom"),a}var k;class T{constructor(){F(this,k,void 0);L(this,"diameter");L(this,"radius");this.x=0,this.y=0,this.width=0,this.height=0,this.pivotX=.5,this.pivotY=.5,this.rotation=0,this.alpha=1,this.visible=!0,this.scaleX=1,this.scaleY=1,this.vX=0,this.vY=0,this.accelerationX=0,this.accelerationY=0,this.frictionX=0,this.frictionY=0,this.gravity=0,this.mass=0,Y(this,k,!1),this.shadow=!1,this.shadowColor="rgba(199, 199, 199, 0.72)",this.shadowOffsetX=10,this.shadowOffsetY=10,this.shadowBlur=10,this.frames=[],this.loop=!0,this.parent=void 0,this.children=[]}get halfWidth(){return this.width*.5}get halfHeight(){return this.height*.5}get centerX(){return this.x+this.halfWidth}get centerY(){return this.y+this.halfHeight}get position(){return{x:this.x,y:this.y}}get scale(){return this.scaleX===this.scaleY?this.scaleX:`scaleX: ${this.scaleX}; scaleY: ${this.scaleY}`}set scale(t){if(this.scaleX!==this.scaleY){console.log("scale X and Y are not equal, please supply two values");return}this.scaleX=t,this.scaleY=t}set acceleration(t){this.accelerationX=t,this.accelerationY=t}set friction(t){this.frictionX=t,this.frictionY=t}setPosition(t,h){[this.x,this.y]=[t,h]}get gx(){return this.parent?this.x+this.parent.gx:this.x}get gy(){return this.parent?this.y+this.parent.gy:this.y}putCenter(t,h=0,s=0){let i=this;t.x=i.x+i.halfWidth-t.halfWidth+h,t.y=i.y+i.halfHeight-t.halfHeight+s}addChild(t){t.parent&&t.parent.removeChild(t),t.parent=this,this.children.push(t)}removeChild(t){if(t.parent===this)this.children.splice(this.children.indexOf(t),1);else throw new Error(t+"is not a child of "+this)}get localBounds(){return{x:0,y:0,width:this.width,height:this.height}}get globalBounds(){return{x:this.gx,y:this.gy,width:this.gx+this.width,height:this.gy+this.height}}get circular(){return y(this,k)}set circular(t){t===!0&&y(this,k)===!1&&(Object.defineProperties(this,{diameter:{get(){return this.width},set(h){this.width=h,this.height=h},enumerable:!0,configurable:!0},radius:{get(){return this.halfWidth},set(h){this.width=h*2,this.height=h*2},enumerable:!0,configurable:!0}}),Y(this,k,!0)),t===!1&&y(this,k)===!0&&(delete this.diameter,delete this.radius,Y(this,k,!1))}}k=new WeakMap;class dt extends T{constructor(...t){super();t.forEach(h=>this.addChild(h))}addChild(t){t.parent&&t.parent.removeChild(t),t.parent=this,this.children.push(t),this.calculateSize()}removeChild(t){if(t.parent===this)this.children.splice(this.children.indexOf(t),1),this.calculateSize();else throw new Error(`${t} is not a child of ${this}`)}calculateSize(){this.children.length>0&&(this._newWidth=0,this._newHeight=0,this.children.forEach(t=>{t.x+t.width>this._newWidth&&(this._newWidth=t.x+t.width),t.y+t.height>this._newHeight&&(this._newHeight=t.y+t.height)}),this.width=this._newWidth,this.height=this._newHeight)}}var q;class W extends T{constructor(t,h=0,s=0){super();F(this,q,void 0);Object.assign(this,{x:h,y:s}),t instanceof Image&&this.createFromImage(t),t.animationStates&&this.createFromTaggedStateFrames(t),t.frame&&this.createFromAtlas(t),t instanceof Array&&this.createFromAtlasFrames(t),this._currentFrame,this.shadow=!0,this.shadowColor="rbga(20,20,20,80%)"}createFromImage(t){this.source=t,this.sourceX=0,this.sourceY=0,this.width=t.width,this.height=t.height,this.sourceWidth=t.width,this.sourceHeight=t.height}createFromAtlas(t){this.tilesetFrame=t,this.source=this.tilesetFrame.source,this.sourceX=this.tilesetFrame.frame.x,this.sourceY=this.tilesetFrame.frame.y,this.width=this.tilesetFrame.frame.w,this.height=this.tilesetFrame.frame.h,this.sourceWidth=this.tilesetFrame.frame.w,this.sourceHeight=this.tilesetFrame.frame.h}createFromAtlasFrames(t){this.frames=t,this.source=t[0].source,this.sourceX=t[0].frame.x,this.sourceY=t[0].frame.y,this.width=t[0].frame.w,this.height=t[0].frame.h,this.sourceWidth=t[0].frame.w,this.sourceHeight=t[0].frame.h}createFromFrameTags(t){this.source=t.image,this.frameTags=t.frameTags;const h=Object.keys(this.frameTags)[0];this.sourceX=this.frameTags[h][0].frame.x,this.sourceY=this.frameTags[h][0].frame.y,this.width=this.sourceWidth=this.frameTags[h][0].frame.w,this.height=this.sourceHeight=this.frameTags[h][0].frame.h}createFromTaggedStateFrames(t){this.source=t.image,this.states=t.animationStates,this.frames=t.animationFrames,this.sourceX=this.frames[0].frame.x,this.sourceY=this.frames[0].frame.y,this.width=this.frames[0].frame.w,this.height=this.frames[0].frame.h,this.sourceWidth=this.frames[0].frame.w,this.sourceHeight=this.frames[0].frame.h}showFrame(t=0){this.sourceX=this.frames[t].frame.x,this.sourceY=this.frames[t].frame.y,this.width=this.frames[t].frame.w,this.height=this.frames[t].frame.h,this.sourceHeight=this.frames[t].frame.h,this.sourceWidth=this.frames[t].frame.w,this._currentFrame=t}draw(t){t.drawImage(this.source,this.sourceX,this.sourceY,this.sourceWidth,this.sourceHeight,-this.width*this.pivotX,-this.height*this.pivotY,this.width,this.height)}}q=new WeakMap,L(W,"frameDelay",3);class ct extends W{constructor(t,h=0,s=0){super(t,h,s);this.playing=!1,this.loop=!1,ot(this)}}class j extends W{constructor(t,h,s){super(t,h,s);this.circular=!0,this.diameter-15,this._currentFrame=0,this.showFrame(0),this.stages=[]}}L(j,"types",["Grapes","Melon","Tomato","Starfruit"]);function N(e,t,h=!1){let s,i,n,r,a;return h?(s=t.gx+t.radius-(e.gx+e.radius),i=t.gy+t.radius-(e.gy+e.radius)):(s=t.centerX-e.centerX,i=t.centerY-e.centerY),n=Math.sqrt(s*s+i*i),r=e.radius+t.radius,a=n<r,a}function I(e,t,h=!1){let s,i,n,r,a;return s=!1,h?(r=e.gx+e.halfWidth-(t.gx+t.halfWidth),a=e.gy+e.halfHeight-(t.gy+t.halfHeight)):(r=e.centerX-t.centerX,a=e.centerY-t.centerY),i=e.halfWidth+t.halfWidth,n=e.halfHeight+t.halfHeight,Math.abs(r)<i&&Math.abs(a)<n?s=!0:s=!1,s}function V(e,t,h=!1,s=!0){let i,n,r,a,l,o,f;return s?(o=e.gx+e.halfWidth-(t.gx+t.halfWidth),f=e.gy+e.halfHeight-(t.gy+t.halfHeight)):(o=e.centerX-t.centerX,f=e.centerY-t.centerY),n=e.halfWidth+t.halfWidth,r=e.halfHeight+t.halfHeight,Math.abs(o)<n&&Math.abs(f)<r&&(a=n-Math.abs(o),l=r-Math.abs(f),a>=l?(f>0?(i="top",e.y=e.y+l):(i="bottom",e.y=e.y-l),h&&(e.vy*=-1)):(o>0?(i="left",e.x=e.x+a):(i="right",e.x=e.x-a),h&&(e.vx*=-1))),i}function J(e,t,h=!1,s=!1){let i,n,r,a,l,o,f,g={},m=!1;return s?(a=t.gx+t.radius-(e.gx+e.radius),l=t.gy+t.radius-(e.gy+e.radius)):(a=t.centerX-e.centerX,l=t.centerY-e.centerY),i=Math.sqrt(a*a+l*l),n=e.radius+t.radius,i<n&&(m=!0,r=n-i,r+=.3,o=a/i,f=l/i,e.x-=r*o,e.y-=r*f,h&&(g.x=l,g.y=-a,pt(e,g))),m}function ut(e,t,h=!1){let s,i,n,r,a={},l={},o={},f={},g={},m=!1;if(e.mass=e.mass||1,t.mass=t.mass||1,h?(a.vx=t.gx+t.radius-(e.gx+e.radius),a.vy=t.gy+t.radius-(e.gy+e.radius)):(a.vx=t.centerX-e.centerX,a.vy=t.centerY-e.centerY),a.magnitude=Math.sqrt(a.vx*a.vx+a.vy*a.vy),s=e.radius+t.radius,a.magnitude<s){m=!0,i=s-a.magnitude,i+=.3,a.dx=a.vx/a.magnitude,a.dy=a.vy/a.magnitude,a.vxHalf=Math.abs(a.dx*i/2),a.vyHalf=Math.abs(a.dy*i/2),e.x>t.x?n=1:n=-1,e.y>t.y?r=1:r=-1,e.x=e.x+a.vxHalf*n,e.y=e.y+a.vyHalf*r,t.x=t.x+a.vxHalf*-n,t.y=t.y+a.vyHalf*-r,a.lx=a.vy,a.ly=-a.vx;let b=e.vx*a.dx+e.vy*a.dy;l.x=b*a.dx,l.y=b*a.dy;let c=e.vx*(a.lx/a.magnitude)+e.vy*(a.ly/a.magnitude);o.x=c*(a.lx/a.magnitude),o.y=c*(a.ly/a.magnitude);let d=t.vx*a.dx+t.vy*a.dy;f.x=d*a.dx,f.y=d*a.dy;let v=t.vx*(a.lx/a.magnitude)+t.vy*(a.ly/a.magnitude);g.x=v*(a.lx/a.magnitude),g.y=v*(a.ly/a.magnitude),e.bounce={},e.bounce.x=o.x+f.x,e.bounce.y=o.y+f.y,t.bounce={},t.bounce.x=l.x+g.x,t.bounce.y=l.y+g.y,e.vx=e.bounce.x/e.mass,e.vy=e.bounce.y/e.mass,t.vx=t.bounce.x/t.mass,t.vy=t.bounce.y/t.mass}return m}function gt(e,t,h,s=!1){let i,n,r,a,l,o;if(s?(r=e.gx,a=e.gy,l=t.gx,o=t.gy):(r=e.x,a=e.y,l=t.x,o=t.y),a<o-t.halfHeight?r<l-1-t.halfWidth?i="topLeft":r>l+1+t.halfWidth?i="topRight":i="topMiddle":a>o+t.halfHeight?r<l-1-t.halfWidth?i="bottomLeft":r>l+1+t.halfWidth?i="bottomRight":i="bottomMiddle":r<l-t.halfWidth?i="leftMiddle":i="rightMiddle",i==="topMiddle"||i==="bottomMiddle"||i==="leftMiddle"||i==="rightMiddle")n=I(e,t,s);else{let f={};switch(i){case"topLeft":f.x=l,f.y=o;break;case"topRight":f.x=l+t.width,f.y=o;break;case"bottomLeft":f.x=l,f.y=o+t.height;break;case"bottomRight":f.x=l+t.width,f.y=o+t.height}n=Q(e,f,s),n=V(e,t,h,s),n=mt(e,f,h,s)}return n&&i}function Q(e,t,h=!1){return t.diameter=1,t.radius=.5,t.centerX=t.x,t.centerY=t.y,t.gx=t.x,t.gy=t.y,N(e,t,h)}function mt(e,t,h=!1,s=!1){return t.diameter=1,t.radius=.5,t.centerX=t.x,t.centerY=t.y,t.gx=t.x,t.gy=t.y,J(e,t,h,s)}function yt(e,t,h=!1){let s,i,n,r,a,l;if(h?(n=e.gx,r=e.gy,a=t.gx,l=t.gy):(n=e.x,r=e.y,a=t.x,l=t.y),r<l-t.halfHeight?n<a-1-t.halfWidth?s="topLeft":n>a+1+t.halfWidth?s="topRight":s="topMiddle":r>l+t.halfHeight?n<a-1-t.halfWidth?s="bottomLeft":n>a+1+t.halfWidth?s="bottomRight":s="bottomMiddle":n<a-t.halfWidth?s="leftMiddle":s="rightMiddle",s==="topMiddle"||s==="bottomMiddle"||s==="leftMiddle"||s==="rightMiddle")i=I(e,t,h);else{let o={};switch(s){case"topLeft":o.x=a,o.y=l;break;case"topRight":o.x=a+t.width,o.y=l;break;case"bottomLeft":o.x=a,o.y=l+t.height;break;case"bottomRight":o.x=a+t.width,o.y=l+t.height}i=Q(e,o,h)}return i&&s}function wt(e,t){let h,s,i,n,r,a,l,o,f;return t.radius?h="circle":h="rectangle",h==="rectangle"&&(s=t.x,i=t.x+t.width,n=t.y,r=t.y+t.height,f=e.x>s&&e.x<i&&e.y>n&&e.y<r),h==="circle"&&(a=e.x-t.centerX,l=e.y-t.centerY,o=Math.sqrt(a*a+l*l),f=o<t.radius),f}function xt(e,t,h=!1,s=!1,i,n=void 0){let r,a=e.parent!==void 0,l=t.parent!==void 0;return a&&t instanceof Array||l&&e instanceof Array?f():(r=o(e,t),r&&n&&n(r)),r;function o(c,d){let v=c.parent!==void 0,D=d.parent!==void 0;if(v&&D)return c.diameter&&d.diameter?g(c,d):c.diameter&&!d.diameter?b(c,d):m(c,d);if(D&&c.x!==void 0&&c.y!==void 0)return wt(c,d);throw new Error(`I'm sorry, ${c} and ${d} cannot be used together in a\xA0collision test.'
\xA0\xA0\xA0\xA0\xA0\xA0`)}function f(){if(e instanceof Array){let[c,d]=[d,c]}for(let c=t.length-1;c>=0;c--){let d=t[c];r=o(e,d),r&&n&&n(r,d)}}function g(c,d){return h?c.vx+c.vy!==0&&d.vx+d.vy!==0?ut(c,d,i):J(c,d,s,i):N(c,d)}function m(c,d){return h?V(c,d,s,i):I(c,d,i)}function b(c,d){return h?gt(c,d,s,i):yt(c,d,i)}}function pt(e,t){let h,s,i={},n={},r={},a=e.mass||1;t.lx=t.y,t.ly=-t.x,t.magnitude=Math.sqrt(t.x*t.x+t.y*t.y),t.dx=t.x/t.magnitude,t.dy=t.y/t.magnitude,h=e.vx*t.dx+e.vy*t.dy,i.vx=h*t.dx,i.vy=h*t.dy,s=e.vx*(t.lx/t.magnitude)+e.vy*(t.ly/t.magnitude),n.vx=s*(t.lx/t.magnitude),n.vy=s*(t.ly/t.magnitude),n.vx*=-1,n.vy*=-1,r.x=i.vx+n.vx,r.y=i.vy+n.vy,e.vx=r.x/a,e.vy=r.y/a}const vt=e=>new ResizeObserver(bt(kt(e))),bt=e=>t=>{t.forEach(h=>{let s=h.target;h===t[0]&&(s=new Proxy(s,e));let{width:i,height:n}=h.contentRect;Object.assign(s,{width:i,height:n})})},kt=e=>({set(t,h,s){const i=t.height;if(h==="width")e[h]=s;else if(h==="height"){e[h]=s;const n=e.children,r=n[0];let[,...a]=n,l=s/i;const o=r.width/r.height;r.height=e.height,r.width=e.height*o,a.forEach(f=>{let{x:g,y:m}=f;f.setPosition(g*l,m*l),f.scale*=l})}return Reflect.set(t,h,s)}});function A(e,t){return Math.floor(Math.random()*(t-e+1))+e}const Xt=(e,t)=>(h,s=2,i=8)=>{const n=new W(h);e.addChild(n);let{x:r,y:a}=n.frames[6].frame;return n.broken=[n.frames[7],n.frames[8]],n.sourceX=r,n.sourceY=a,n.hitbox=new E(s,i,"none","none"),n.addChild(n.hitbox),n.putCenter(n.hitbox),l=>Object.assign(n,l)};function U(e){return new Promise(t=>setTimeout(t,e))}function Ht(e,t,h,s,i,n){let r=n();r.inFlight=!0,r.rotation=t,r.x=e.centerX-r.halfWidth+h*Math.cos(t),r.y=e.centerY-r.halfHeight+h*Math.sin(t),r.friction=.985,r.vx=Math.cos(t)*s,r.vy=Math.sin(t)*s,i.push(r)}function Ft(e){let t=Object.keys(e).filter(h=>/(crop|growing)/.test(h));e.crops={};for(let h of t){const[,s,i]=/^([^_]+)_([^_.]+)/.exec(h);e.crops[s]||(e.crops[s]={}),e.crops[s][i]||(e.crops[s][i]=[]),e.crops[s][i].push({name:h,frame:e[h]})}}class O{constructor(t,h=()=>console.log(`${t} pressed`),s=()=>console.log(`${t} released`)){if(this.code=t,this.isDown=!1,this.isUp=!0,this.press=h,this.release=s,this.test,this.code instanceof Array){let i=new Set(this.code);this.test=n=>i.has(n)}else this.test=i=>i===this.code;window.addEventListener("keydown",this.downHandler.bind(this)),window.addEventListener("keyup",this.upHandler.bind(this))}downHandler(t){this.test(t.code)&&(t.preventDefault(),this.isDown=!0,this.isUp=!1,this.press())}upHandler(t){this.test(t.code)&&(t.preventDefault(),this.isUp=!0,this.isDown=!1,this.release())}}const _=["Left","Up","Right","Down"],x={None:0,[_[0]]:1<<0,[_[1]]:1<<1,[_[2]]:1<<2,[_[3]]:1<<3};function Yt(e,{ifUp:t,ifDown:h,ifLeft:s,ifRight:i}){e&x.Up&&t(),e&x.Right&&i(),e&x.Down&&h(),e&x.Left&&s()}function St(e,t=1){let h={element:e,scale:t,_x:0,_y:0,get x(){return this._x/this.scale},get y(){return this._y/this.scale},get centerX(){return this.x},get centerY(){return this.y},get position(){return{x:this.x,y:this.y}},isDown:!1,isUp:!0,tapped:!1,downTime:0,elapsedTime:0,press:void 0,release:void 0,tap:void 0,moveHandler(s){let i=s.target;this._x=s.pageX-i.offsetLeft,this._y=s.pageY-i.offsetTop,s.preventDefault()},touchmoveHandler(s){let i=s.target;this._x=s.targetTouches[0].pageX-i.offsetLeft,this._y=s.targetTouches[0].pageY-i.offsetTop,s.preventDefault()},downHandler(s){this.isDown=!0,this.isUp=!1,this.tapped=!1,this.downTime=Date.now(),this.press&&this.press(s),s.preventDefault()},touchstartHandler(s){let i=s.target;this._x=s.targetTouches[0].pageX-i.offsetLeft,this._y=s.targetTouches[0].pageY-i.offsetTop,this.isDown=!0,this.isUp=!1,this.tapped=!1,this.downTime=Date.now(),this.press&&this.press(),s.preventDefault()},upHandler(s){this.elapsedTime=Math.abs(this.downTime-Date.now()),this.elapsedTime<=200&&this.tapped===!1&&(this.tapped=!0,this.tap&&this.tap()),this.isUp=!0,this.isDown=!1,this.release&&this.release(),s.preventDefault()},touchendHandler(s){this.elapsedTime=Math.abs(this.downTime-Date.now()),this.elapsedTime<=200&&this.tapped===!1&&(this.tapped=!0,this.tap&&this.tap()),this.isUp=!0,this.isDown=!1,this.release&&this.release(),s.preventDefault()}};return e.addEventListener("mousemove",h.moveHandler.bind(h),!1),e.addEventListener("mousedown",h.downHandler.bind(h),!1),window.addEventListener("mouseup",h.upHandler.bind(h),!1),e.addEventListener("touchmove",h.touchmoveHandler.bind(h),!1),e.addEventListener("touchstart",h.touchstartHandler.bind(h),!1),window.addEventListener("touchend",h.touchendHandler.bind(h),!1),e.style.touchAction="none",h}function Tt(e,t){let h=t.ctx;h.clearRect(0,0,t.width,t.height),e.children.forEach(i=>{s(i)});function s(i){i.visible&&i.gx<t.width+i.width&&i.gx+i.width>=-i.width&&i.gy<t.height+i.height&&i.gy+i.height>=-i.height&&(h.save(),h.translate(i.x+i.width*i.pivotX,i.y+i.height*i.pivotY),h.rotate(i.rotation),h.globalAlpha=i.alpha*i.parent.alpha,h.scale(i.scaleX,i.scaleY),i.draw&&i.draw(h),i.children&&i.children.length>0&&(h.translate(-i.width*i.pivotX,-i.height*i.pivotY),i.children.forEach(n=>{s(n)})),h.restore())}}const Mt=30,Z=1e3/Mt;class E extends T{constructor(t=32,h=32,s="hotpink",i="none",n=0,r=0,a=0){super();Object.assign(this,{width:t,height:h,fillStyle:s,strokeStyle:i,lineWidth:n,x:r,y:a}),this.mask=!1}draw(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.fillStyle=this.fillStyle,t.beginPath(),t.rect(-this.width*this.pivotX,-this.height*this.pivotY,this.width,this.height),this.strokeStyle!=="none"&&t.stroke(),this.fillStyle!=="none"&&t.fill(),this.mask&&this.mask===!0&&t.clip()}}var z;class Lt extends T{constructor(t=32,h="gray",s="none",i=0,n=0,r=0){super();F(this,z,void 0);this.circular=!0,Object.assign(this,{diameter:t,fillStyle:h,strokeStyle:s,lineWidth:i,x:n,y:r}),this.mask=!1}draw(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.fillStyle=this.fillStyle,t.beginPath(),t.arc(this.radius+-this.diameter*this.pivotX,this.radius+-this.diameter*this.pivotY,this.radius,0,2*Math.PI,!1),this.strokeStyle!=="none"&&t.stroke(),this.fillStyle!=="none"&&t.fill(),this.mask&&this.mask===!0&&t.clip()}}z=new WeakMap;var P,C,w;class Wt extends ct{constructor(t,h=120,s=120){super(t);F(this,P,void 0);F(this,C,void 0);F(this,w,void 0);this.hitbox=new E(h,s,"none","none"),Y(this,P,0),this.addChild(this.hitbox),this.putCenter(this.hitbox,0,4),this.attackRange=new Lt(40,"none","none",3),this.addChild(this.attackRange),this.putCenter(this.attackRange),Object.assign(this,{x:120,y:120,shadow:!0,friction:.72,acceleration:3}),this.facing="Down",this.animation="shield",this.state="standing"}set state(t){this.switchState(t),Y(this,C,t)}get state(){return y(this,C)}switchState(t){let h;switch(t){case"standing":this.playing=!1,this.animation="shield",this.show(this.states[`${this.animation}${this.facing}`][0]);break;case"moving":this.animation="shield",this.loop=!0,this.playSequence(this.states[`${this.animation}${this.facing}`]);break;case"attack":if(y(this,w).mouse.button===2&&(Math.abs(y(this,w).mouse.atan2)>2?this.facing="Left":Math.abs(y(this,w).mouse.atan2)<1?this.facing="Right":y(this,w).mouse.atan2<0?this.facing="Up":this.facing="Down"),this.vX*this.vY>this.accelerationX*this.accelerationY&&y(this,w).mouse.button===0?h="dash":h=["stab",["swipe","swing"][A(0,1)],"bow"][y(this,w).mouse.button],y(this,w).mouse.button=void 0,this.state==="attack")return;this.stopAnimation(),this.fps=24,this.onComplete=()=>{this.loop=!0,this.playing=!1,this.fps=12,this.show(this.states[`shield${this.facing}`][0]),this.onComplete=null},this.loop=!1,this.playSequence(this.states[`${h}${this.facing}`]);break}}standing(){!y(this,w).gamestate==="inTown"&&y(this,w).mouse.button in[1,2,3]&&(this.state="attack"),y(this,w).kb.dir!==x.None&&(this.state="moving")}moving(){if(y(this,w).mouse.button in[1,2,3]){this.state="attack";return}if(y(this,w).kb.dir===x.None){this.state="standing";return}this.move(y(this,w).kb.dir)}attack(){this.playing||(this.state="standing")}act(t){this.update()}move(t){Yt(t,{ifUp:()=>this.vY-=this.accelerationY,ifDown:()=>this.vY+=this.accelerationY,ifLeft:()=>this.vX-=this.accelerationX,ifRight:()=>this.vX+=this.accelerationX})}update(t){Y(this,w,t),this[`${this.state}`](),this.vX*=this.frictionX,this.vY*=this.frictionY,this.x=this.x+this.vX,this.y=this.y+this.vY}}P=new WeakMap,C=new WeakMap,w=new WeakMap;class Ct extends T{constructor(t="Hello!",h="12px sans-serif",s="red",i=0,n=0){super();Object.assign(this,{content:t,font:h,fillStyle:s,x:i,y:n}),this.textBaseline="top",this.strokeText="none"}draw(t){t.font=this.font,t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.fillStyle=this.fillStyle,this.width===0&&(this.width=t.measureText(this.content).width),this.height===0&&(this.height=t.measureText("M").width),t.translate(-this.width*this.pivotX,-this.height*this.pivotY),t.textBaseline=this.textBaseline,t.fillText(this.content,0,0),this.strokeText!=="none"&&t.strokeText()}}let Dt="inTown";X.load(["src/assets/bg.json","src/assets/sprites.json","src/assets/Link.json","src/assets/silver.ttf"]).then(()=>et());let Rt=6,tt;function et(){Ft(X),console.log(X);const e=lt("app");e.ctx;let t=0,h=0;const s=new T;[s.width,s.height]=[e.width,e.height],vt(s).observe(e);const i=new E;Object.assign(i,{width:25,height:90,x:495,y:270}),document.querySelector(".modal").classList.add("hidden");const r=["bg_outdoors.png","bg_town.png"],a=1,l=new W(X[r[a]]),o=new Wt(X.Link,16,26);let f=new Ct("","12px puzzler","black",8,8);const g=new dt;[l,i,o,g,f].forEach(u=>s.addChild(u)),console.log(s);const m=new E(250,200,"none","red",1,100,180);s.addChild(m),tt=[];const b=()=>Xt(s)(Object.keys(X).filter(u=>/arrow.+/.test(u)).map(u=>X[u]))({scale:s.children[1].scale}),c=(u,p)=>{c.reloading||(Ht(u,p,0,20,tt,b),c.reloading=!0)};let d={kb:{dir:x.None,left:new O(["ArrowLeft","KeyA"],function(){d.kb.dir|=x.Left,o.facing="Left"},function(){d.kb.dir&=~x.Left}),up:new O(["ArrowUp","KeyW"],function(){d.kb.dir|=x.Up,o.facing="Up"},function(){d.kb.dir&=~x.Up}),right:new O(["ArrowRight","KeyD"],function(){d.kb.dir|=x.Right,o.facing="Right"},function(){d.kb.dir&=~x.Right}),down:new O(["ArrowDown","KeyS"],function(){d.kb.dir|=x.Down,o.facing="Down"},function(){d.kb.dir&=~x.Down})},mouse:{},gamestate:Dt};const v=St(e);v.press=u=>{d.mouse.button=u.button,c.reloading&&d.mouse.button===2&&d.mouse.button,u.button===2&&!c.reloading&&(c(o,Math.atan2(v.centerY-o.y,v.centerX-o.x)),U(300).then(()=>c.reloading=!1)),d.mouse.atan2=Math.atan2(v.centerY-o.y,v.centerX-o.x)},v.release=u=>{d.mouse.button=void 0};const D=new Set(["Space"]);addEventListener("contextmenu",u=>u.preventDefault()),addEventListener("keypress",u=>{D.has(u.code)&&u.preventDefault});function it(){s.putCenter(l),o.update(d),ft(o,s.localBounds),st(),xt(o,i,!1,!1,"none",(u,p)=>console.log(u,p,o.vX))&&Math.abs(o.vX)<.1&&et()}B();function B(u){for(u||(u=0),h+=u-t;h>=Z;)it(),h-=Z;Tt(s,e),t=u,requestAnimationFrame(B)}const R=[];let H=!0;setInterval(()=>{console.log(R)},5e3);function st(){H&&R.length<Rt&&Math.random()<.8&&u(R),R.forEach(p=>{if(p.showFrame(p._currentFrame),!H)return;Math.random()<.8&&$(p);function $(S){S._currentFrame+=1,S.showFrame(S._currentFrame),H=!1,U(A(4,20)*1e3).then(()=>H=!0)}});function u(p){if(!H)return;console.log(p);let $=Math.random()<.7?"Starfruit":j.types[A(0,2)],S=X.crops[$];console.log(p);const M=new j(S.growing.map(ht=>ht.frame),Math.random()*m.width,Math.random()*m.height);console.log(M),m.addChild(M),M.scale=1,M.harvest=S.crop,p.push(M),H=!1,U(A(4,20)*1e3).then(()=>H=!0)}}}
