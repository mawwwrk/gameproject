var j=Object.defineProperty;var _=(i,t,e)=>t in i?j(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var Y=(i,t,e)=>(_(i,typeof t!="symbol"?t+"":t,e),e),E=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)};var d=(i,t,e)=>(E(i,t,"read from private field"),e?e.call(i):t.get(i)),y=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)},x=(i,t,e,h)=>(E(i,t,"write to private field"),h?h.call(i,e):t.set(i,e),e);var k=(i,t,e)=>(E(i,t,"access private method"),e);import"https://cdn.skypack.dev/normalizecss";const I=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))h(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&h(l)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function h(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}};I();let p={toLoad:0,loaded:0,load(i){return new Promise(t=>{const e=()=>{this.loaded+=1,this.toLoad===this.loaded&&(this.toLoad=0,this.loaded=0,t())};this.toLoad=i.length,i.forEach(h=>{const s=h.split(".").pop();s==="json"&&this.loadJson(h,e),["ttf","otf","woff"].indexOf(s)!==-1&&this.loadFont(h,e)})})},loadFont(i,t){let e=i.split("/").pop().split(".")[0],h=document.createElement("style"),s=`@font-face {font-family:'${e}'; src: url(${i});}`;h.appendChild(document.createTextNode(s)),document.head.appendChild(h),t()},async loadJson(i,t){const h=await(await fetch(i)).json();let s=/(?<=\/)\w+\.\w+$/.exec(i)[0];this[s]=h,h.meta.frameTags?this.processFrameTags(s,h,t):h.frames?this.processFrames(h,t):t()},processFrameTags(i,t,e){const h=i.split(".").shift(),s=t.meta.image,a=Object.keys(t.frames),l=()=>{this[s]=o,this[h]={image:this[s],frameTags:{},animationStates:{},animationFrames:[]},(()=>{for(let n of t.meta.frameTags){let{name:f,from:w,to:u}=n;this[h].animationStates[f]=[w,u]}a.forEach(n=>{this[h].animationFrames.push(t.frames[n])})})(),e()};let o=new Image;o.addEventListener("load",l),o.src=s},processFrames(i,t){const e=i.meta.image,h=()=>{this[e]=s,Object.keys(i.frames).forEach(a=>{this[a]=i.frames[a],this[a].source=this[e]}),t()};let s=new Image;s.addEventListener("load",h),s.src=e}};var b;class S{constructor(){y(this,b,void 0);Y(this,"diameter");Y(this,"radius");this.x=0,this.y=0,this.width=0,this.height=0,this.pivotX=.5,this.pivotY=.5,this.rotation=0,this.alpha=1,this.visible=!0,this.scaleX=1,this.scaleY=1,this.vX=0,this.vY=0,this.accelerationX=0,this.accelerationY=0,this.frictionX=0,this.frictionY=0,this.gravity=0,this.mass=0,x(this,b,!1),this.shadow=!1,this.shadowColor="rgba(100, 100, 100, 0.5)",this.shadowOffsetX=3,this.shadowOffsetY=3,this.shadowBlur=3,this.frames=[],this.loop=!0,this.parent=void 0,this.children=[]}get halfWidth(){return this.width*.5}get halfHeight(){return this.height*.5}get centerX(){return this.x+this.halfWidth}get centerY(){return this.y+this.halfHeight}get position(){return{x:this.x,y:this.y}}get scale(){return this.scaleX===this.scaleY?this.scaleX:`scaleX: ${this.scaleX}; scaleY: ${this.scaleY}`}set scale(t){if(this.scaleX!==this.scaleY){console.log("scale X and Y are not equal, please supply two values");return}this.scaleX=t,this.scaleY=t}set acceleration(t){this.accelerationX=t,this.accelerationY=t}set friction(t){this.frictionX=t,this.frictionY=t}setPosition(t,e){[this.x,this.y]=[t,e]}get gx(){return this.parent?this.x+this.parent.gx:this.x}get gy(){return this.parent?this.y+this.parent.gy:this.y}putCenter(t,e=0,h=0){let s=this;t.x=s.x+s.halfWidth-t.halfWidth+e,t.y=s.y+s.halfHeight-t.halfHeight+h}addChild(t){t.parent&&t.parent.removeChild(t),t.parent=this,this.children.push(t)}removeChild(t){if(t.parent===this)this.children.splice(this.children.indexOf(t),1);else throw new Error(t+"is not a child of "+this)}get localBounds(){return{x:0,y:0,width:this.width,height:this.height}}get globalBounds(){return{x:this.gx,y:this.gy,width:this.gx+this.width,height:this.gy+this.height}}get circular(){return d(this,b)}set circular(t){t===!0&&d(this,b)===!1&&(Object.defineProperties(this,{diameter:{get(){return this.width},set(e){this.width=e,this.height=e},enumerable:!0,configurable:!0},radius:{get(){return this.halfWidth},set(e){this.width=e*2,this.height=e*2},enumerable:!0,configurable:!0}}),x(this,b,!0)),t===!1&&d(this,b)===!0&&(delete this.diameter,delete this.radius,x(this,b,!1))}}b=new WeakMap;class z extends S{constructor(...t){super();t.forEach(e=>this.addChild(e))}addChild(t){t.parent&&t.parent.removeChild(t),t.parent=this,this.children.push(t),this.calculateSize()}removeChild(t){if(t.parent===this)this.children.splice(this.children.indexOf(t),1),this.calculateSize();else throw new Error(`${t} is not a child of ${this}`)}calculateSize(){this.children.length>0&&(this._newWidth=0,this._newHeight=0,this.children.forEach(t=>{t.x+t.width>this._newWidth&&(this._newWidth=t.x+t.width),t.y+t.height>this._newHeight&&(this._newHeight=t.y+t.height)}),this.width=this._newWidth,this.height=this._newHeight)}}function C(i){let t=0,e=0,h=0,s=0,a;function l(u){o(),i.showFrame(u)}function o(){i.playing=!1,t=0,h=0,s=0,e=0,clearInterval(a)}function m(){f([0,i.frames.length-1])}function n(){o(),i.showFrame(i._currentFrame)}function f(u){o(),h=u[0],s=u[1],e=s-h,h===0&&(e+=1,t+=1),e===1&&(e=2,t+=1),i.fps||(i.fps=12);let r=1e3/i.fps;i.showFrame(h),i.playing||(a=setInterval(w.bind(this),r),i.playing=!0)}function w(){t<e?(i.showFrame(i._currentFrame+1),t+=1):(i.loop&&(i.showFrame(h),t=1),(this==null?void 0:this.onComplete)&&this.onComplete())}Object.assign(i,{show:l,playAnimation:m,stopAnimation:n,playSequence:f})}let R=0;function U(i="canvas",t=256,e=256){const h=document.createElement("canvas");return++R,i==="canvas"?h.classList.add(`${i}${R}`):h.id=i,h.width=t,h.height=e,document.body.insertBefore(h,document.querySelectorAll("body > :last-child")[0]),h.ctx=h.getContext("2d"),h}function K(i,t,e=!1){let h=t.x,s=t.y,a=t.width,l=t.height,o,m=.96,n={};i.hitbox?(n.x=i.hitbox.gx,n.y=i.hitbox.gy,n.width=i.hitbox.width,n.height=i.hitbox.height):(n.x=i.x,n.y=i.y,n.width=i.width,n.height=i.height);let f=i.hitbox?(i.width-i.hitbox.width)/2:0,w=i.hitbox?(i.height-i.hitbox.height)/2:0;return n.x<0&&(e&&(i.vx*=-m),i.mass&&(i.vx/=i.mass),i.x=h-f,o="left"),n.y<s&&(e&&(i.vy*=-m),i.mass&&(i.vy/=i.mass),i.y=s-w,o="top"),n.x+n.width>a&&(e&&(n.vx*=-m),i.mass&&(i.vx/=i.mass),i.x=a-i.width+f,o="right"),n.y+n.height>l&&(e&&(i.vy*=-m),i.mass&&(i.vy/=i.mass),i.y=l-i.height+w,o="bottom"),o}const q=i=>new ResizeObserver(B(M(i))),B=i=>t=>{t.forEach(e=>{let h=e.target;e===t[0]&&(h=new Proxy(h,i));let{width:s,height:a}=e.contentRect;Object.assign(h,{width:s,height:a})})},M=i=>({set(t,e,h){const s=t.width;if((e==="width"||e==="height")&&(i[e]=h),e==="width"){const a=i.children,l=a[0];let[,...o]=a,m=h/s;const n=l.height/l.width;l.width=i.width,l.height=i.width*n,s!==256&&o.forEach(f=>{let{x:w,y:u,scaleX:r}=f;f.setPosition(w*m,u*m),f.scale=r*m})}return Reflect.set(t,e,h)}});function W(i,t){return Math.floor(Math.random()*(t-i+1))+i}function N(i){return t=>Object.keys(i).filter(e=>e.match(`${t}_`)).map(e=>i[e])}class H{constructor(t,e=()=>console.log(`${t} pressed`),h=()=>console.log(`${t} released`)){if(this.code=t,this.isDown=!1,this.isUp=!0,this.press=e,this.release=h,this.test,this.code instanceof Array){let s=new Set(this.code);this.test=a=>s.has(a)}else this.test=s=>s===this.code;window.addEventListener("keydown",this.downHandler.bind(this)),window.addEventListener("keyup",this.upHandler.bind(this))}downHandler(t){this.test(t.code)&&(t.preventDefault(),this.isDown=!0,this.isUp=!1,this.press())}upHandler(t){this.test(t.code)&&(t.preventDefault(),this.isUp=!0,this.isDown=!1,this.release())}}const c={None:0,Up:1<<0,Right:1<<1,Down:1<<2,Left:1<<3};function V(i,{ifUp:t,ifDown:e,ifLeft:h,ifRight:s}){i&c.Up&&t(),i&c.Right&&s(),i&c.Down&&e(),i&c.Left&&h()}function G(i,t){let e=t.ctx;e.clearRect(0,0,t.width,t.height),i.children.forEach(s=>{h(s)});function h(s){s.visible&&s.gx<t.width+s.width&&s.gx+s.width>=-s.width&&s.gy<t.height+s.height&&s.gy+s.height>=-s.height&&(e.save(),e.translate(s.x+s.width*s.pivotX,s.y+s.height*s.pivotY),e.rotate(s.rotation),e.globalAlpha=s.alpha*s.parent.alpha,e.scale(s.scaleX,s.scaleY),s.draw&&s.draw(e),s.children&&s.children.length>0&&(e.translate(-s.width*s.pivotX,-s.height*s.pivotY),s.children.forEach(a=>{h(a)})),e.restore())}}const J=15,T=1e3/J;var $;class O extends S{constructor(t,e=0,h=0){super();y(this,$,void 0);Object.assign(this,{x:e,y:h}),t instanceof Image&&this.createFromImage(t),t.animationStates&&this.createFromTaggedStateFrames(t),t.frame&&this.createFromAtlas(t),t instanceof Array&&this.createFromAtlasFrames(t),this._currentFrame,this.playing=!1,this.loop=!0}createFromImage(t){this.source=t,this.sourceX=0,this.sourceY=0,this.width=t.width,this.height=t.height,this.sourceWidth=t.width,this.sourceHeight=t.height}createFromAtlas(t){this.tilesetFrame=t,this.source=this.tilesetFrame.source,this.sourceX=this.tilesetFrame.frame.x,this.sourceY=this.tilesetFrame.frame.y,this.width=this.tilesetFrame.frame.w,this.height=this.tilesetFrame.frame.h,this.sourceWidth=this.tilesetFrame.frame.w,this.sourceHeight=this.tilesetFrame.frame.h}createFromAtlasFrames(t){this.frames=t,this.source=t[0].source,this.sourceX=t[0].frame.x,this.sourceY=t[0].frame.y,this.width=t[0].frame.w,this.height=t[0].frame.h,this.sourceWidth=t[0].frame.w,this.sourceHeight=t[0].frame.h}createFromFrameTags(t){this.source=t.image,this.frameTags=t.frameTags;const e=Object.keys(this.frameTags)[0];this.sourceX=this.frameTags[e][0].frame.x,this.sourceY=this.frameTags[e][0].frame.y,this.width=this.sourceWidth=this.frameTags[e][0].frame.w,this.height=this.sourceHeight=this.frameTags[e][0].frame.h}createFromTaggedStateFrames(t){this.source=t.image,this.states=t.animationStates,this.frames=t.animationFrames,this.sourceX=this.frames[0].frame.x,this.sourceY=this.frames[0].frame.y,this.width=this.frames[0].frame.w,this.height=this.frames[0].frame.h,this.sourceWidth=this.frames[0].frame.w,this.sourceHeight=this.frames[0].frame.h}showFrame(t=0){this.sourceX=this.frames[t].frame.x,this.sourceY=this.frames[t].frame.y,this.width=this.frames[t].frame.w,this.height=this.frames[t].frame.h,this.sourceHeight=this.frames[t].frame.h,this.sourceWidth=this.frames[t].frame.w,this._currentFrame=t}draw(t){t.drawImage(this.source,this.sourceX,this.sourceY,this.sourceWidth,this.sourceHeight,-this.width*this.pivotX,-this.height*this.pivotY,this.width,this.height)}}$=new WeakMap,Y(O,"frameDelay",3);var A,F,g;class Q extends O{constructor(t,e=120,h=120){super(t);y(this,A,void 0);y(this,F,void 0);y(this,g,void 0);this.hitbox=new et(e,h,"none","none"),x(this,A,0),this.addChild(this.hitbox),this.putCenter(this.hitbox),Object.assign(this,{x:120,y:120,shadow:!0,friction:.8,acceleration:1.5}),this.facing="Down",this.animation="moveShield",C(this),this.state="standing"}set state(t){this.switchState(t),x(this,F,t)}get state(){return d(this,F)}switchState(t){switch(t){case"standing":this.playing=!1,this.animation="moveShield",this.show(this.states[`${this.animation}${this.facing}`][0]);break;case"moving":this.animation="moveShield",this.loop=!0,this.playSequence(this.states[`${this.animation}${this.facing}`]);break;case"swing":let e=d(this,g).mouse.button+1;if(console.log(d(this,g).mouse.button),d(this,g).mouse.button=void 0,this.state==="swing")return;this.stopAnimation(),this.onComplete=()=>{this.loop=!0,this.playing=!1,this.show(this.states[`moveShield${this.facing}`][0]),this.onComplete=null},this.loop=!1,this.playSequence(this.states[`swing${this.facing}${e}`]);break}}standing(){d(this,g).mouse.button in[1,2]&&(this.state="swing"),d(this,g).kb.dir!==c.None&&(this.state="moving")}moving(){if(d(this,g).kb.dir&~c[`${this.facing}`]&&(this.state="moving"),d(this,g).mouse.button in[1,2]){this.state="swing";return}if(d(this,g).kb.dir===c.None){this.state="standing";return}this.move(d(this,g).kb.dir)}swing(){this.playing||(this.state="standing")}act(t){this.update()}move(t){V(t,{ifUp:()=>this.vY-=this.accelerationY,ifDown:()=>this.vY+=this.accelerationY,ifLeft:()=>this.vX-=this.accelerationX,ifRight:()=>this.vX+=this.accelerationX})}update(t){x(this,g,t),this[`${this.state}`](),this.vX*=this.frictionX,this.vY*=this.frictionY,this.x=this.x+this.vX,this.y=this.y+this.vY}}A=new WeakMap,F=new WeakMap,g=new WeakMap;const L={Horizontal:0,Vertical:1};var D,tt,X,P;class Z extends O{constructor(){super(...arguments);y(this,D);y(this,X)}shakeAround(){this.x+=W(-2,2),this.y+=W(-2,2)}newRandomDestination(){this.newX=k(this,X,P).call(this,L.Horizontal),this.newY=k(this,X,P).call(this,L.Vertical)}move(){let[t,e]=[this.x-this.newX,this.y-this.newY];(t||e)&&(this.vX+=this.accelerationX*Math.sign(t),this.vY+=this.accelerationY*Math.sign(e)),this.vX*=this.frictionX,this.vY*=this.frictionY,this.x-=this.vX,this.y-=this.vY}}D=new WeakSet,tt=function(t){let e;return t===L.Horizontal&&(e="width"),t===L.Vertical&&(e="height"),this.parent[e]-this[e]},X=new WeakSet,P=function(t){return Math.random()*k(this,D,tt).call(this,t)};var v;class it extends Z{constructor(t,e,h){super(t);y(this,v,void 0);Object.assign(this,{x:e,y:h,shadow:!0,scaleX:2,scaleY:2,accelerationX:1.5,accelerationY:1.5,frictionX:.75,frictionY:.75,mass:1}),this.actions={idle:[4,4,5,5,6,6,5,5]},this.state="idle",this.currentFrame=0,this.fps=6,C(this)}act(){this.state==="idle"&&!this.playing&&this.playAnimation([4,6]),d(this,v)||x(this,v,setTimeout(()=>{this.newRandomDestination.call(this),x(this,v,!1)},W(5e3,1e4))),this.move()}}v=new WeakMap;class et extends S{constructor(t=32,e=32,h="hotpink",s="none",a=0,l=0,o=0){super();Object.assign(this,{width:t,height:e,fillStyle:h,strokeStyle:s,lineWidth:a,x:l,y:o}),this.mask=!1}draw(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.fillStyle=this.fillStyle,t.beginPath(),t.rect(-this.width*this.pivotX,-this.height*this.pivotY,this.width,this.height),this.strokeStyle!=="none"&&t.stroke(),this.fillStyle!=="none"&&t.fill(),this.mask&&this.mask===!0&&t.clip()}}p.load(["src/assets/link_master.json","src/assets/bg.json","src/assets/enemies.json","src/assets/blob.json","src/assets/silver.ttf"]).then(()=>st());function st(){console.log(p);const i=U("app");i.ctx;let t=0,e=0;const h=new S;[h.width,h.height]=[i.width,i.height],q(h).observe(i);const s=new O(p["outdoors.png"]);let a=[];const l=new it(N(p)("pinkblob"),100,100);a=[...a,l];const o=new Q(p.link_master,16,26);o.scale=1.5;const m=new z;[s,o,l,m].forEach(r=>h.addChild(r));let n={kb:{},mouse:{}};n.kb.dir=c.None,new H(["ArrowLeft","KeyA"],function(){n.kb.dir|=c.Left,o.facing="Left"},function(){n.kb.dir&=~c.Left}),new H(["ArrowUp","KeyW"],function(){n.kb.dir|=c.Up,o.facing="Up"},function(){n.kb.dir&=~c.Up}),new H(["ArrowRight","KeyD"],function(){n.kb.dir|=c.Right,o.facing="Right"},function(){n.kb.dir&=~c.Right}),new H(["ArrowDown","KeyS"],function(){n.kb.dir|=c.Down,o.facing="Down"},function(){n.kb.dir&=~c.Down});let f;addEventListener("pointerdown",r=>{r.preventDefault(),n.mouse.button=r.button,f=performance.now()}),addEventListener("pointerup",r=>{r.preventDefault(),n.mouse.button=void 0,f=performance.now()-f});function w(){h.putCenter(s),o.update(n),l.act(),K(o,h.localBounds)}u();function u(r){for(r||(r=0),e+=r-t;e>=T;)w(),e-=T;G(h,i),t=r,requestAnimationFrame(u)}}
