var k=Object.defineProperty;var O=(s,t,i)=>t in s?k(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i;var m=(s,t,i)=>(O(s,typeof t!="symbol"?t+"":t,i),i),y=(s,t,i)=>{if(!t.has(s))throw TypeError("Cannot "+i)};var c=(s,t,i)=>(y(s,t,"read from private field"),i?i.call(s):t.get(s)),p=(s,t,i)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,i)},d=(s,t,i,h)=>(y(s,t,"write to private field"),h?h.call(s,i):t.set(s,i),i);import"https://cdn.skypack.dev/normalizecss";const H=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))h(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&h(o)}).observe(document,{childList:!0,subtree:!0});function i(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerpolicy&&(a.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?a.credentials="include":e.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function h(e){if(e.ep)return;e.ep=!0;const a=i(e);fetch(e.href,a)}};H();let u={toLoad:0,loaded:0,load(s){return new Promise(t=>{const i=()=>{this.loaded+=1,this.toLoad===this.loaded&&(this.toLoad=0,this.loaded=0,t())};this.toLoad=s.length,s.forEach(h=>{h.split(".").pop()==="json"&&this.loadJson(h,i)})})},async loadJson(s,t){const h=await(await fetch(s)).json();let e=/(?<=\/)\w+\.\w+$/.exec(s)[0];this[e]=h,h.meta.frameTags?this.processFrameTags(e,h,t):h.frames?this.processFrames(h,t):t()},processFrameTags(s,t,i){const h=s.split(".").shift(),e=t.meta.image,a=Object.keys(t.frames),o=()=>{var w;this[e]=r,this[h]={image:this[e],frameTags:{}};for(let F of t.meta.frameTags){let{name:f,from:L,to:T}=F,g=L+0;((w=this[h].frameTags)==null?void 0:w[f])||(this[h].frameTags[f]=[]);do this[h].frameTags[f].push(t.frames[a[g]].frame),g++;while(g<=T)}i()};let r=new Image;r.addEventListener("load",o),r.src=e},processFrames(s,t){const i=s.meta.image,h=()=>{this[i]=e,Object.keys(s.frames).forEach(a=>{this[a]=s.frames[a],this[a].source=this[i]}),t()};let e=new Image;e.addEventListener("load",h),e.src=i}};var n;class x{constructor(){p(this,n,void 0);m(this,"diameter");m(this,"radius");this.x=0,this.y=0,this.width=0,this.height=0,this.pivotX=.5,this.pivotY=.5,this.rotation=0,this.alpha=1,this.visible=!0,this.scaleX=1,this.scaleY=1,this.vx=0,this.vy=0,this.accelerationX=0,this.accelerationY=0,this.frictionX=0,this.frictionY=0,this.gravity=0,this.mass=0,d(this,n,!1),this.parent=void 0,this.children=[]}get halfWidth(){return this.width*.5}get halfHeight(){return this.height*.5}get centerX(){return this.x+this.halfWidth}get centerY(){return this.y+this.halfHeight}get position(){return{x:this.x,y:this.y}}setPosition(t,i){[this.x,this.y]=[t,i]}get gx(){return this.parent?this.x+this.parent.gx:this.x}get gy(){return this.parent?this.y+this.parent.gy:this.y}putCenter(t,i=0,h=0){let e=this;t.x=e.x+e.halfWidth-t.halfWidth+i,t.y=e.y+e.halfHeight-t.halfHeight+h}addChild(t){t.parent&&t.parent.removeChild(t),t.parent=this,this.children.push(t)}removeChild(t){if(t.parent===this)this.children.splice(this.children.indexOf(t),1);else throw new Error(t+"is not a child of "+this)}get localBounds(){return{x:0,y:0,width:this.width,height:this.height}}get globalBounds(){return{x:this.gx,y:this.gy,width:this.gx+this.width,height:this.gy+this.height}}get circular(){return c(this,n)}set circular(t){t===!0&&c(this,n)===!1&&(Object.defineProperties(this,{diameter:{get(){return this.width},set(i){this.width=i,this.height=i},enumerable:!0,configurable:!0},radius:{get(){return this.halfWidth},set(i){this.width=i*2,this.height=i*2},enumerable:!0,configurable:!0}}),d(this,n,!0)),t===!1&&c(this,n)===!0&&(delete this.diameter,delete this.radius,d(this,n,!1))}}n=new WeakMap;class b extends x{constructor(t,i=0,h=0){super();Object.assign(this,{x:i,y:h}),t instanceof Image&&this.createFromImage(t),t.frameTags&&this.createFromFrameTags(t),t.frame&&this.createFromAtlas(t)}createFromImage(t){this.source=t,this.sourceX=0,this.sourceY=0,this.width=t.width,this.height=t.height,this.sourceWidth=t.width,this.sourceHeight=t.height}createFromAtlas(t){this.tilesetFrame=t,this.source=this.tilesetFrame.source,this.sourceX=this.tilesetFrame.frame.x,this.sourceY=this.tilesetFrame.frame.y,this.width=this.tilesetFrame.frame.w,this.height=this.tilesetFrame.frame.h,this.sourceWidth=this.tilesetFrame.frame.w,this.sourceHeight=this.tilesetFrame.frame.h}createFromFrameTags(t){this.source=t.image,this.frameTags=t.frameTags;const i=Object.keys(this.frameTags)[0];this.sourceX=this.frameTags[i][0].x,this.sourceY=this.frameTags[i][0].y,this.width=this.sourceWidth=this.frameTags[i][0].w,this.height=this.sourceHeight=this.frameTags[i][0].h}draw(t){t.drawImage(this.source,this.sourceX,this.sourceY,this.sourceWidth,this.sourceHeight,-this.width*this.pivotX,-this.height*this.pivotY,this.width,this.height)}}let v=0;function X(s="canvas",t=256,i=256){const h=document.createElement("canvas");return++v,s==="canvas"?h.classList.add(`${s}${v}`):h.id=s,h.width=t,h.height=i,document.body.insertBefore(h,document.querySelectorAll("body > :last-child")[0]),h.ctx=h.getContext("2d"),h}const Y=s=>new ResizeObserver(E(D(s))),E=s=>t=>{t.forEach(i=>{let h=i.target;i===t[0]&&(h=new Proxy(h,s));let{width:e,height:a}=i.contentRect;Object.assign(h,{width:e,height:a})})},D=s=>({set(t,i,h){return(i==="width"||i==="height")&&(s[i]=h),Reflect.set(t,i,h)}});class j{constructor(t,i=()=>console.log(`${t} pressed`),h=()=>console.log(`${t} released`)){this.code=t,this.isDown=!1,this.isUp=!0,this.press=i,this.release=h,window.addEventListener("keydown",this.downHandler.bind(this)),window.addEventListener("keyup",this.upHandler.bind(this))}downHandler(t){t.code===this.code&&(this.press(),this.isDown=!0,this.isUp=!1),t.preventDefault()}upHandler(t){t.code===this.code&&(this.release(),this.isUp=!0,this.isDown=!1),t.preventDefault()}}const l={None:0,Left:1<<0,Right:1<<1,Up:1<<2,Down:1<<3};function C(s,t){let i=t.ctx;i.clearRect(0,0,t.width,t.height),s.children.forEach(e=>{h(e)});function h(e){e.visible&&e.gx<t.width+e.width&&e.gx+e.width>=-e.width&&e.gy<t.height+e.height&&e.gy+e.height>=-e.height&&(i.save(),i.translate(e.x+e.width*e.pivotX,e.y+e.height*e.pivotY),i.rotate(e.rotation),i.globalAlpha=e.alpha*e.parent.alpha,i.scale(e.scaleX,e.scaleY),e.draw&&e.draw(i),e.children&&e.children.length>0&&(i.translate(-e.width*e.pivotX,-e.height*e.pivotY),e.children.forEach(a=>{h(a)})),i.restore())}}u.load(["src/assets/link_master.json","src/assets/bg.json","src/assets/enemies.json"]).then(()=>W());function W(){let s=l.None;["Left","Right","Up","Down"].map(r=>{new j(`Arrow${r}`,()=>s|=l[r],()=>s&=~l[r])});const t=X("app"),i=new x;[i.width,i.height]=[t.width,t.height],Y(i).observe(t);const h=new b(u["outdoors.png"]),e=new b(u.link_master),a=1.8;Object.assign(e,{scaleX:a,scaleY:a}),console.log(e),[h,e].forEach(r=>i.addChild(r)),o();function o(){i.putCenter(h),s&l.Up&&(e.y-=1),s&l.Down&&(e.y+=1),s&l.Left&&(e.x-=1),s&l.Right&&(e.x+=1),requestAnimationFrame(o),C(i,t)}}
