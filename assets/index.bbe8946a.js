var nt=Object.defineProperty;var ot=(e,t,i)=>t in e?nt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var L=(e,t,i)=>(ot(e,typeof t!="symbol"?t+"":t,i),i),P=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)};var x=(e,t,i)=>(P(e,t,"read from private field"),i?i.call(e):t.get(e)),H=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},Y=(e,t,i,h)=>(P(e,t,"write to private field"),h?h.call(e,i):t.set(e,i),i);var A=(e,t,i)=>(P(e,t,"access private method"),i);import"https://cdn.skypack.dev/normalizecss";const rt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))h(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&h(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function h(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}};rt();let lt=new AudioContext;class dt{constructor(t,i){this.source=t,this.loadHandler=i,this.actx=lt,this.volumeNode=this.actx.createGain(),this.panNode=this.actx.createStereoPanner(),this.soundNode=null,this.buffer=null,this.loop=!1,this.playing=!1,this.panValue=0,this.volumeValue=1,this.startTime=0,this.startOffset=0,this.load()}load(){let t=new XMLHttpRequest;t.open("GET",this.source,!0),t.responseType="arraybuffer",t.addEventListener("load",()=>{this.actx.decodeAudioData(t.response,i=>{this.buffer=i,this.hasLoaded=!0,this.loadHandler&&this.loadHandler()},i=>{throw new Error("Audio could not be decoded: "+i)})}),t.send()}play(){this.startTime=this.actx.currentTime,this.soundNode=this.actx.createBufferSource(),this.soundNode.buffer=this.buffer,this.soundNode.connect(this.volumeNode),this.volumeNode.connect(this.panNode),this.panNode.connect(this.actx.destination),this.soundNode.loop=this.loop,this.soundNode.start(this.startTime,this.startOffset%this.buffer.duration),this.playing=!0}pause(){this.playing&&(this.soundNode.stop(this.actx.currentTime),this.startOffset+=this.actx.currentTime-this.startTime,this.playing=!1)}restart(){this.playing&&this.soundNode.stop(this.actx.currentTime),this.startOffset=0,this.play()}playFrom(t){this.playing&&this.soundNode.stop(this.actx.currentTime),this.startOffset=t,this.play()}get volume(){return this.volumeValue}set volume(t){this.volumeNode.gain.value=t,this.volumeValue=t}get pan(){return this.panNode.pan.value}set pan(t){this.panNode.pan.value=t}}function ft(e,t){return new dt(e,t)}let S={toLoad:0,loaded:0,load(e){return new Promise(t=>{const i=()=>{this.loaded+=1,this.toLoad===this.loaded&&(this.toLoad=0,this.loaded=0,t())};this.toLoad=e.length,e.forEach(h=>{const s=h.split(".").pop();s==="json"&&this.loadJson(h,i),["ttf","otf","woff"].indexOf(s)!==-1&&this.loadFont(h,i),s==="mp3"&&this.loadAudio(h,i)})})},loadFont(e,t){let i=e.split("/").pop().split(".")[0],h=document.createElement("style"),s=`@font-face {font-family:'${i}'; src: url(${e});}`;h.appendChild(document.createTextNode(s)),document.head.appendChild(h),t()},loadAudio(e,t){let i=ft(e,t);i.name=e,this[i.name]=i},async loadJson(e,t){const h=await(await fetch(e)).json();let s=/(?<=\/)\w+\.\w+$/.exec(e)[0];this[s]=h,h.meta.frameTags?this.processFrameTags(s,h,t):h.frames?this.processFrames(h,t):t()},processFrameTags(e,t,i){const h=e.split(".").shift(),s=t.meta.image,n=Object.keys(t.frames),o=()=>{this[s]=a,this[h]={image:this[s],frameTags:{},animationStates:{},animationFrames:[]},(()=>{for(let r of t.meta.frameTags){let{name:d,from:m,to:y}=r;this[h].animationStates[d]=[m,y]}n.forEach(r=>{this[h].animationFrames.push(t.frames[r])})})(),i()};let a=new Image;a.addEventListener("load",o),a.src=s},processFrames(e,t){const i=e.meta.image,h=()=>{this[i]=s,Object.keys(e.frames).forEach(n=>{this[n]=e.frames[n],this[n].source=this[i]}),t()};let s=new Image;s.addEventListener("load",h),s.src=i}};var X;class F{constructor(){H(this,X,void 0);L(this,"diameter");L(this,"radius");this.x=0,this.y=0,this.width=0,this.height=0,this.pivotX=.5,this.pivotY=.5,this.rotation=0,this.alpha=1,this.visible=!0,this.scaleX=1,this.scaleY=1,this.vX=0,this.vY=0,this.accelerationX=0,this.accelerationY=0,this.frictionX=0,this.frictionY=0,this.gravity=0,this.mass=0,Y(this,X,!1),this.shadow=!1,this.shadowColor="rgba(100, 100, 100, 0.5)",this.shadowOffsetX=3,this.shadowOffsetY=3,this.shadowBlur=3,this.frames=[],this.loop=!0,this.parent=void 0,this.children=[]}get halfWidth(){return this.width*.5}get halfHeight(){return this.height*.5}get centerX(){return this.x+this.halfWidth}get centerY(){return this.y+this.halfHeight}get position(){return{x:this.x,y:this.y}}get scale(){return this.scaleX===this.scaleY?this.scaleX:`scaleX: ${this.scaleX}; scaleY: ${this.scaleY}`}set scale(t){if(this.scaleX!==this.scaleY){console.log("scale X and Y are not equal, please supply two values");return}this.scaleX=t,this.scaleY=t}set acceleration(t){this.accelerationX=t,this.accelerationY=t}set friction(t){this.frictionX=t,this.frictionY=t}setPosition(t,i){[this.x,this.y]=[t,i]}get gx(){return this.parent?this.x+this.parent.gx:this.x}get gy(){return this.parent?this.y+this.parent.gy:this.y}putCenter(t,i=0,h=0){let s=this;t.x=s.x+s.halfWidth-t.halfWidth+i,t.y=s.y+s.halfHeight-t.halfHeight+h}addChild(t){t.parent&&t.parent.removeChild(t),t.parent=this,this.children.push(t)}removeChild(t){if(t.parent===this)this.children.splice(this.children.indexOf(t),1);else throw new Error(t+"is not a child of "+this)}get localBounds(){return{x:0,y:0,width:this.width,height:this.height}}get globalBounds(){return{x:this.gx,y:this.gy,width:this.gx+this.width,height:this.gy+this.height}}get circular(){return x(this,X)}set circular(t){t===!0&&x(this,X)===!1&&(Object.defineProperties(this,{diameter:{get(){return this.width},set(i){this.width=i,this.height=i},enumerable:!0,configurable:!0},radius:{get(){return this.halfWidth},set(i){this.width=i*2,this.height=i*2},enumerable:!0,configurable:!0}}),Y(this,X,!0)),t===!1&&x(this,X)===!0&&(delete this.diameter,delete this.radius,Y(this,X,!1))}}X=new WeakMap;class U extends F{constructor(...t){super();t.forEach(i=>this.addChild(i))}addChild(t){t.parent&&t.parent.removeChild(t),t.parent=this,this.children.push(t),this.calculateSize()}removeChild(t){if(t.parent===this)this.children.splice(this.children.indexOf(t),1),this.calculateSize();else throw new Error(`${t} is not a child of ${this}`)}calculateSize(){this.children.length>0&&(this._newWidth=0,this._newHeight=0,this.children.forEach(t=>{t.x+t.width>this._newWidth&&(this._newWidth=t.x+t.width),t.y+t.height>this._newHeight&&(this._newHeight=t.y+t.height)}),this.width=this._newWidth,this.height=this._newHeight)}}function q(e){let t=0,i=0,h=0,s=0,n;function o(y){a(),e.showFrame(y)}function a(){e.playing=!1,t=0,h=0,s=0,i=0,clearInterval(n)}function l(){d([0,e.frames.length-1])}function r(){a(),e.showFrame(e._currentFrame)}function d(y){a(),h=y[0],s=y[1],i=s-h,h===0&&(i+=1,t+=1),i===1&&(i=2,t+=1),e.fps||(e.fps=12);let v=1e3/e.fps;e.showFrame(h),e.playing||(n=setInterval(m.bind(this),v),e.playing=!0)}function m(){t<i?(e.showFrame(e._currentFrame+1),t+=1):(e.loop&&(e.showFrame(h),t=1),(this==null?void 0:this.onComplete)&&this.onComplete())}Object.assign(e,{show:o,playAnimation:l,stopAnimation:r,playSequence:d})}let B=0;function ct(e="canvas",t=384,i=384){const h=document.createElement("canvas");return++B,e==="canvas"?h.classList.add(`${e}${B}`):h.id=e,h.width=t,h.height=i,document.body.insertBefore(h,document.querySelectorAll("body > :last-child")[0]),h.ctx=h.getContext("2d"),h}function z(e,t,i=!1){let h=t.x,s=t.y,n=t.width,o=t.height,a,l=.96,r={};e.hitbox?(r.x=e.hitbox.gx,r.y=e.hitbox.gy,r.width=e.hitbox.width,r.height=e.hitbox.height):(r.x=e.x,r.y=e.y,r.width=e.width,r.height=e.height);let d=e.hitbox?(e.width-e.hitbox.width)/2:0,m=e.hitbox?(e.height-e.hitbox.height)/2:0;return r.x<0&&(i&&(e.vx*=-l),e.mass&&(e.vx/=e.mass),e.x=h-d,a="left"),r.y<s&&(i&&(e.vy*=-l),e.mass&&(e.vy/=e.mass),e.y=s-m,a="top"),r.x+r.width>n&&(i&&(r.vx*=-l),e.mass&&(e.vx/=e.mass),e.x=n-e.width+d,a="right"),r.y+r.height>o&&(i&&(e.vy*=-l),e.mass&&(e.vy/=e.mass),e.y=o-e.height+m,a="bottom"),a}function V(e,t,i=!1){let h,s,n,o,a;return i?(h=t.gx+t.radius-(e.gx+e.radius),s=t.gy+t.radius-(e.gy+e.radius)):(h=t.centerX-e.centerX,s=t.centerY-e.centerY),n=Math.sqrt(h*h+s*s),o=e.radius+t.radius,a=n<o,a}function _(e,t,i=!1){let h,s,n,o,a;return h=!1,i?(o=e.gx+e.halfWidth-(t.gx+t.halfWidth),a=e.gy+e.halfHeight-(t.gy+t.halfHeight)):(o=e.centerX-t.centerX,a=e.centerY-t.centerY),s=e.halfWidth+t.halfWidth,n=e.halfHeight+t.halfHeight,Math.abs(o)<s&&Math.abs(a)<n?h=!0:h=!1,h}function K(e,t,i=!1,h=!0){let s,n,o,a,l,r,d;return h?(r=e.gx+e.halfWidth-(t.gx+t.halfWidth),d=e.gy+e.halfHeight-(t.gy+t.halfHeight)):(r=e.centerX-t.centerX,d=e.centerY-t.centerY),n=e.halfWidth+t.halfWidth,o=e.halfHeight+t.halfHeight,Math.abs(r)<n&&Math.abs(d)<o&&(a=n-Math.abs(r),l=o-Math.abs(d),a>=l?(d>0?(s="top",e.y=e.y+l):(s="bottom",e.y=e.y-l),i&&(e.vy*=-1)):(r>0?(s="left",e.x=e.x+a):(s="right",e.x=e.x-a),i&&(e.vx*=-1))),s}function G(e,t,i=!1,h=!1){let s,n,o,a,l,r,d,m={},y=!1;return h?(a=t.gx+t.radius-(e.gx+e.radius),l=t.gy+t.radius-(e.gy+e.radius)):(a=t.centerX-e.centerX,l=t.centerY-e.centerY),s=Math.sqrt(a*a+l*l),n=e.radius+t.radius,s<n&&(y=!0,o=n-s,o+=.3,r=a/s,d=l/s,e.x-=o*r,e.y-=o*d,i&&(m.x=l,m.y=-a,wt(e,m))),y}function ut(e,t,i=!1){let h,s,n,o,a={},l={},r={},d={},m={},y=!1;if(e.mass=e.mass||1,t.mass=t.mass||1,i?(a.vx=t.gx+t.radius-(e.gx+e.radius),a.vy=t.gy+t.radius-(e.gy+e.radius)):(a.vx=t.centerX-e.centerX,a.vy=t.centerY-e.centerY),a.magnitude=Math.sqrt(a.vx*a.vx+a.vy*a.vy),h=e.radius+t.radius,a.magnitude<h){y=!0,s=h-a.magnitude,s+=.3,a.dx=a.vx/a.magnitude,a.dy=a.vy/a.magnitude,a.vxHalf=Math.abs(a.dx*s/2),a.vyHalf=Math.abs(a.dy*s/2),e.x>t.x?n=1:n=-1,e.y>t.y?o=1:o=-1,e.x=e.x+a.vxHalf*n,e.y=e.y+a.vyHalf*o,t.x=t.x+a.vxHalf*-n,t.y=t.y+a.vyHalf*-o,a.lx=a.vy,a.ly=-a.vx;let v=e.vx*a.dx+e.vy*a.dy;l.x=v*a.dx,l.y=v*a.dy;let u=e.vx*(a.lx/a.magnitude)+e.vy*(a.ly/a.magnitude);r.x=u*(a.lx/a.magnitude),r.y=u*(a.ly/a.magnitude);let c=t.vx*a.dx+t.vy*a.dy;d.x=c*a.dx,d.y=c*a.dy;let g=t.vx*(a.lx/a.magnitude)+t.vy*(a.ly/a.magnitude);m.x=g*(a.lx/a.magnitude),m.y=g*(a.ly/a.magnitude),e.bounce={},e.bounce.x=r.x+d.x,e.bounce.y=r.y+d.y,t.bounce={},t.bounce.x=l.x+m.x,t.bounce.y=l.y+m.y,e.vx=e.bounce.x/e.mass,e.vy=e.bounce.y/e.mass,t.vx=t.bounce.x/t.mass,t.vy=t.bounce.y/t.mass}return y}function mt(e,t,i,h=!1){let s,n,o,a,l,r;if(h?(o=e.gx,a=e.gy,l=t.gx,r=t.gy):(o=e.x,a=e.y,l=t.x,r=t.y),a<r-t.halfHeight?o<l-1-t.halfWidth?s="topLeft":o>l+1+t.halfWidth?s="topRight":s="topMiddle":a>r+t.halfHeight?o<l-1-t.halfWidth?s="bottomLeft":o>l+1+t.halfWidth?s="bottomRight":s="bottomMiddle":o<l-t.halfWidth?s="leftMiddle":s="rightMiddle",s==="topMiddle"||s==="bottomMiddle"||s==="leftMiddle"||s==="rightMiddle")n=_(e,t,h);else{let d={};switch(s){case"topLeft":d.x=l,d.y=r;break;case"topRight":d.x=l+t.width,d.y=r;break;case"bottomLeft":d.x=l,d.y=r+t.height;break;case"bottomRight":d.x=l+t.width,d.y=r+t.height}n=J(e,d,h),n=K(e,t,i,h),n=gt(e,d,i,h)}return n&&s}function J(e,t,i=!1){return t.diameter=1,t.radius=.5,t.centerX=t.x,t.centerY=t.y,t.gx=t.x,t.gy=t.y,V(e,t,i)}function gt(e,t,i=!1,h=!1){return t.diameter=1,t.radius=.5,t.centerX=t.x,t.centerY=t.y,t.gx=t.x,t.gy=t.y,G(e,t,i,h)}function yt(e,t,i=!1){let h,s,n,o,a,l;if(i?(n=e.gx,o=e.gy,a=t.gx,l=t.gy):(n=e.x,o=e.y,a=t.x,l=t.y),o<l-t.halfHeight?n<a-1-t.halfWidth?h="topLeft":n>a+1+t.halfWidth?h="topRight":h="topMiddle":o>l+t.halfHeight?n<a-1-t.halfWidth?h="bottomLeft":n>a+1+t.halfWidth?h="bottomRight":h="bottomMiddle":n<a-t.halfWidth?h="leftMiddle":h="rightMiddle",h==="topMiddle"||h==="bottomMiddle"||h==="leftMiddle"||h==="rightMiddle")s=_(e,t,i);else{let r={};switch(h){case"topLeft":r.x=a,r.y=l;break;case"topRight":r.x=a+t.width,r.y=l;break;case"bottomLeft":r.x=a,r.y=l+t.height;break;case"bottomRight":r.x=a+t.width,r.y=l+t.height}s=J(e,r,i)}return s&&h}function xt(e,t){let i,h,s,n,o,a,l,r,d;return t.radius?i="circle":i="rectangle",i==="rectangle"&&(h=t.x,s=t.x+t.width,n=t.y,o=t.y+t.height,d=e.x>h&&e.x<s&&e.y>n&&e.y<o),i==="circle"&&(a=e.x-t.centerX,l=e.y-t.centerY,r=Math.sqrt(a*a+l*l),d=r<t.radius),d}function Q(e,t,i=!1,h=!1,s,n=void 0){let o,a=e.parent!==void 0,l=t.parent!==void 0;return a&&t instanceof Array||l&&e instanceof Array?d():(o=r(e,t),o&&n&&n(o)),o;function r(u,c){let g=u.parent!==void 0,k=c.parent!==void 0;if(g&&k)return u.diameter&&c.diameter?m(u,c):u.diameter&&!c.diameter?v(u,c):y(u,c);if(k&&u.x!==void 0&&u.y!==void 0)return xt(u,c);throw new Error(`I'm sorry, ${u} and ${c} cannot be used together in a\xA0collision test.'
\xA0\xA0\xA0\xA0\xA0\xA0`)}function d(){if(e instanceof Array){let[u,c]=[c,u]}for(let u=t.length-1;u>=0;u--){let c=t[u];o=r(e,c),o&&n&&n(o,c)}}function m(u,c){return i?u.vx+u.vy!==0&&c.vx+c.vy!==0?ut(u,c,s):G(u,c,h,s):V(u,c)}function y(u,c){return i?K(u,c,h,s):_(u,c,s)}function v(u,c){return i?mt(u,c,h,s):yt(u,c,s)}}function wt(e,t){let i,h,s={},n={},o={},a=e.mass||1;t.lx=t.y,t.ly=-t.x,t.magnitude=Math.sqrt(t.x*t.x+t.y*t.y),t.dx=t.x/t.magnitude,t.dy=t.y/t.magnitude,i=e.vx*t.dx+e.vy*t.dy,s.vx=i*t.dx,s.vy=i*t.dy,h=e.vx*(t.lx/t.magnitude)+e.vy*(t.ly/t.magnitude),n.vx=h*(t.lx/t.magnitude),n.vy=h*(t.ly/t.magnitude),n.vx*=-1,n.vy*=-1,o.x=s.vx+n.vx,o.y=s.vy+n.vy,e.vx=o.x/a,e.vy=o.y/a}const pt=e=>new ResizeObserver(vt(bt(e))),vt=e=>t=>{t.forEach(i=>{let h=i.target;i===t[0]&&(h=new Proxy(h,e));let{width:s,height:n}=i.contentRect;Object.assign(h,{width:s,height:n})})},bt=e=>({set(t,i,h){const s=t.height;if(i==="width")e[i]=h;else if(i==="height"){e[i]=h;const n=e.children,o=n[0];let[,...a]=n,l=h/s;const r=o.width/o.height;o.height=e.height,o.width=e.height*r,a.forEach(d=>{let{x:m,y}=d;d.setPosition(m*l,y*l),d.scale*=l})}return Reflect.set(t,i,h)}});function T(e,t){return Math.floor(Math.random()*(t-e+1))+e}function kt(e){return t=>Object.keys(e).filter(i=>i.match(`${t}_`)).map(i=>e[i])}const Ht=(e,t)=>(i,h=2,s=8)=>{const n=new M(i);e.addChild(n);let{x:o,y:a}=n.frames[n.states.arrowRight[0]].frame;return n.sourceX=o,n.sourceY=a,n.hitbox=new st(h,s,"none","none"),n.addChild(n.hitbox),n.putCenter(n.hitbox),l=>Object.assign(n,l)};function Xt(e){return new Promise(t=>setTimeout(t,e))}function Yt(e,t,i,h,s,n){let o=n();o.rotation=t,o.x=e.centerX-o.halfWidth+i*Math.cos(t),o.y=e.centerY-o.halfHeight+i*Math.sin(t),o.vx=Math.cos(t)*h,o.vy=Math.sin(t)*h,s.push(o)}function Z(...e){e.forEach(t=>{t.parent.removeChild(t)})}function Tt(e,t,i=void 0){let h=t.x,s=t.y,n=t.width,o=t.height,a;return e.x<h-e.width&&(a="left"),e.y<s-e.height&&(a="top"),e.x>n&&(a="right"),e.y>o&&(a="bottom"),a&&i&&i(a),a}class D{constructor(t,i=()=>console.log(`${t} pressed`),h=()=>console.log(`${t} released`)){if(this.code=t,this.isDown=!1,this.isUp=!0,this.press=i,this.release=h,this.test,this.code instanceof Array){let s=new Set(this.code);this.test=n=>s.has(n)}else this.test=s=>s===this.code;window.addEventListener("keydown",this.downHandler.bind(this)),window.addEventListener("keyup",this.upHandler.bind(this))}downHandler(t){this.test(t.code)&&(t.preventDefault(),this.isDown=!0,this.isUp=!1,this.press())}upHandler(t){this.test(t.code)&&(t.preventDefault(),this.isUp=!0,this.isDown=!1,this.release())}}const p={None:0,Up:1<<0,Right:1<<1,Down:1<<2,Left:1<<3};function St(e,{ifUp:t,ifDown:i,ifLeft:h,ifRight:s}){e&p.Up&&t(),e&p.Right&&s(),e&p.Down&&i(),e&p.Left&&h()}function Ft(e,t=1){let i={element:e,scale:t,_x:0,_y:0,get x(){return this._x/this.scale},get y(){return this._y/this.scale},get centerX(){return this.x},get centerY(){return this.y},get position(){return{x:this.x,y:this.y}},isDown:!1,isUp:!0,tapped:!1,downTime:0,elapsedTime:0,press:void 0,release:void 0,tap:void 0,moveHandler(h){let s=h.target;this._x=h.pageX-s.offsetLeft,this._y=h.pageY-s.offsetTop,h.preventDefault()},touchmoveHandler(h){let s=h.target;this._x=h.targetTouches[0].pageX-s.offsetLeft,this._y=h.targetTouches[0].pageY-s.offsetTop,h.preventDefault()},downHandler(h){this.isDown=!0,this.isUp=!1,this.tapped=!1,this.downTime=Date.now(),this.press&&this.press(h),h.preventDefault()},touchstartHandler(h){let s=h.target;this._x=h.targetTouches[0].pageX-s.offsetLeft,this._y=h.targetTouches[0].pageY-s.offsetTop,this.isDown=!0,this.isUp=!1,this.tapped=!1,this.downTime=Date.now(),this.press&&this.press(),h.preventDefault()},upHandler(h){this.elapsedTime=Math.abs(this.downTime-Date.now()),this.elapsedTime<=200&&this.tapped===!1&&(this.tapped=!0,this.tap&&this.tap()),this.isUp=!0,this.isDown=!1,this.release&&this.release(),h.preventDefault()},touchendHandler(h){this.elapsedTime=Math.abs(this.downTime-Date.now()),this.elapsedTime<=200&&this.tapped===!1&&(this.tapped=!0,this.tap&&this.tap()),this.isUp=!0,this.isDown=!1,this.release&&this.release(),h.preventDefault()}};return e.addEventListener("mousemove",i.moveHandler.bind(i),!1),e.addEventListener("mousedown",i.downHandler.bind(i),!1),window.addEventListener("mouseup",i.upHandler.bind(i),!1),e.addEventListener("touchmove",i.touchmoveHandler.bind(i),!1),e.addEventListener("touchstart",i.touchstartHandler.bind(i),!1),window.addEventListener("touchend",i.touchendHandler.bind(i),!1),e.style.touchAction="none",i}function tt(e,t){let i=t.ctx;i.clearRect(0,0,t.width,t.height),e.children.forEach(s=>{h(s)});function h(s){s.visible&&s.gx<t.width+s.width&&s.gx+s.width>=-s.width&&s.gy<t.height+s.height&&s.gy+s.height>=-s.height&&(i.save(),i.translate(s.x+s.width*s.pivotX,s.y+s.height*s.pivotY),i.rotate(s.rotation),i.globalAlpha=s.alpha*s.parent.alpha,i.scale(s.scaleX,s.scaleY),s.draw&&s.draw(i),s.children&&s.children.length>0&&(i.translate(-s.width*s.pivotX,-s.height*s.pivotY),s.children.forEach(n=>{h(n)})),i.restore())}}const Lt=30,et=1e3/Lt;var $;class M extends F{constructor(t,i=0,h=0){super();H(this,$,void 0);Object.assign(this,{x:i,y:h}),t instanceof Image&&this.createFromImage(t),t.animationStates&&this.createFromTaggedStateFrames(t),t.frame&&this.createFromAtlas(t),t instanceof Array&&this.createFromAtlasFrames(t),this._currentFrame,this.shadow=!0,this.shadowColor="rbga(20,20,20,80%)",this.playing=!1,this.loop=!1,q(this)}createFromImage(t){this.source=t,this.sourceX=0,this.sourceY=0,this.width=t.width,this.height=t.height,this.sourceWidth=t.width,this.sourceHeight=t.height}createFromAtlas(t){this.tilesetFrame=t,this.source=this.tilesetFrame.source,this.sourceX=this.tilesetFrame.frame.x,this.sourceY=this.tilesetFrame.frame.y,this.width=this.tilesetFrame.frame.w,this.height=this.tilesetFrame.frame.h,this.sourceWidth=this.tilesetFrame.frame.w,this.sourceHeight=this.tilesetFrame.frame.h}createFromAtlasFrames(t){this.frames=t,this.source=t[0].source,this.sourceX=t[0].frame.x,this.sourceY=t[0].frame.y,this.width=t[0].frame.w,this.height=t[0].frame.h,this.sourceWidth=t[0].frame.w,this.sourceHeight=t[0].frame.h}createFromFrameTags(t){this.source=t.image,this.frameTags=t.frameTags;const i=Object.keys(this.frameTags)[0];this.sourceX=this.frameTags[i][0].frame.x,this.sourceY=this.frameTags[i][0].frame.y,this.width=this.sourceWidth=this.frameTags[i][0].frame.w,this.height=this.sourceHeight=this.frameTags[i][0].frame.h}createFromTaggedStateFrames(t){this.source=t.image,this.states=t.animationStates,this.frames=t.animationFrames,this.sourceX=this.frames[0].frame.x,this.sourceY=this.frames[0].frame.y,this.width=this.frames[0].frame.w,this.height=this.frames[0].frame.h,this.sourceWidth=this.frames[0].frame.w,this.sourceHeight=this.frames[0].frame.h}showFrame(t=0){this.sourceX=this.frames[t].frame.x,this.sourceY=this.frames[t].frame.y,this.width=this.frames[t].frame.w,this.height=this.frames[t].frame.h,this.sourceHeight=this.frames[t].frame.h,this.sourceWidth=this.frames[t].frame.w,this._currentFrame=t}draw(t){t.drawImage(this.source,this.sourceX,this.sourceY,this.sourceWidth,this.sourceHeight,-this.width*this.pivotX,-this.height*this.pivotY,this.width,this.height)}}$=new WeakMap,L(M,"frameDelay",3);var E,R,w;class Mt extends M{constructor(t,i=120,h=120){super(t);H(this,E,void 0);H(this,R,void 0);H(this,w,void 0);this.hitbox=new st(i,h,"none","none"),Y(this,E,0),this.addChild(this.hitbox),this.putCenter(this.hitbox,0,4),this.attackRange=new Dt(40,"none","none",3),this.addChild(this.attackRange),this.putCenter(this.attackRange),Object.assign(this,{x:120,y:120,shadow:!0,friction:.8,acceleration:5}),this.facing="Down",this.animation="shield",this.state="standing"}set state(t){this.switchState(t),Y(this,R,t)}get state(){return x(this,R)}switchState(t){let i;switch(t){case"standing":this.playing=!1,this.animation="shield",this.show(this.states[`${this.animation}${this.facing}`][0]);break;case"moving":this.animation="shield",this.loop=!0,this.playSequence(this.states[`${this.animation}${this.facing}`]);break;case"attack":if(x(this,w).mouse.button===2&&(Math.abs(x(this,w).mouse.atan2)>2?this.facing="Left":Math.abs(x(this,w).mouse.atan2)<1?this.facing="Right":x(this,w).mouse.atan2<0?this.facing="Up":this.facing="Down"),this.state==="moving"&&x(this,w).mouse.button===0?i="dash":i=["stab",["swipe","swing"][T(0,1)],"bow"][x(this,w).mouse.button],x(this,w).mouse.button=void 0,this.state==="attack")return;this.stopAnimation(),this.fps=24,this.onComplete=()=>{this.loop=!0,this.playing=!1,this.fps=12,this.show(this.states[`shield${this.facing}`][0]),this.onComplete=null},this.loop=!1,this.playSequence(this.states[`${i}${this.facing}`]);break}}standing(){x(this,w).mouse.button in[1,2,3]&&(this.state="attack"),x(this,w).kb.dir!==p.None&&(this.state="moving")}moving(){if(x(this,w).kb.dir&~p[`${this.facing}`]&&(this.state="moving"),x(this,w).mouse.button in[1,2,3]){this.state="attack";return}if(x(this,w).kb.dir===p.None){this.state="standing";return}this.move(x(this,w).kb.dir)}attack(){this.playing||(this.state="standing")}act(t){this.update()}move(t){St(t,{ifUp:()=>this.y-=this.accelerationY,ifDown:()=>this.y+=this.accelerationY,ifLeft:()=>this.x-=this.accelerationX,ifRight:()=>this.x+=this.accelerationX})}update(t){Y(this,w,t),this[`${this.state}`](),this.vX*=this.frictionX,this.vY*=this.frictionY,this.x=this.x+this.vX,this.y=this.y+this.vY}}E=new WeakMap,R=new WeakMap,w=new WeakMap;const C={Horizontal:0,Vertical:1};var O,Wt,W,it;class Rt extends M{constructor(){super(...arguments);H(this,O);H(this,W);L(this,"movingRandomly")}shakeAround(){this.x+=T(-2,2),this.y+=T(-2,2)}newRandomDestination(){this.newX=A(this,W,it).call(this,C.Horizontal),this.newY=A(this,W,it).call(this,C.Vertical)}move(){let[t,i]=[this.x-this.newX,this.y-this.newY];(t||i)&&(this.vX+=this.accelerationX*Math.sign(t),this.vY+=this.accelerationY*Math.sign(i)),this.vX*=this.frictionX,this.vY*=this.frictionY,this.x-=this.vX,this.y-=this.vY}act(){this.state==="idle"&&!this.playing&&this.playAnimation(this.randomiseActions()),this.movingRandomly||(this.movingRandomly=setTimeout(()=>{this.newRandomDestination.call(this),this.asdmovingRandomly=!1},T(5e3,1e4))),this.move()}}O=new WeakSet,Wt=function(t){let i;return t===C.Horizontal&&(i="width"),t===C.Vertical&&(i="height"),this.parent[i]-this[i]},W=new WeakSet,it=function(t){return Math.random()*A(this,O,Wt).call(this,t)};class At extends Rt{constructor(t,i,h){super(t);this.hp=3,Object.assign(this,{x:i,y:h,shadow:!0,accelerationX:1,accelerationY:1,frictionX:.75,frictionY:.75,loop:!0,mass:1}),this.actions={idle:[4,4,5,5,6,6,5,5]},this.randomiseActions(),this.state="idle",this.currentFrame=0,this.fps=6,q(this)}randomiseActions(){return[T(3,7),T(3,7)]}}class st extends F{constructor(t=32,i=32,h="hotpink",s="none",n=0,o=0,a=0){super();Object.assign(this,{width:t,height:i,fillStyle:h,strokeStyle:s,lineWidth:n,x:o,y:a}),this.mask=!1}draw(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.fillStyle=this.fillStyle,t.beginPath(),t.rect(-this.width*this.pivotX,-this.height*this.pivotY,this.width,this.height),this.strokeStyle!=="none"&&t.stroke(),this.fillStyle!=="none"&&t.fill(),this.mask&&this.mask===!0&&t.clip()}}var N;class Dt extends F{constructor(t=32,i="gray",h="none",s=0,n=0,o=0){super();H(this,N,void 0);this.circular=!0,Object.assign(this,{diameter:t,fillStyle:i,strokeStyle:h,lineWidth:s,x:n,y:o}),this.mask=!1}draw(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.fillStyle=this.fillStyle,t.beginPath(),t.arc(this.radius+-this.diameter*this.pivotX,this.radius+-this.diameter*this.pivotY,this.radius,0,2*Math.PI,!1),this.strokeStyle!=="none"&&t.stroke(),this.fillStyle!=="none"&&t.fill(),this.mask&&this.mask===!0&&t.clip()}}N=new WeakMap;class Ct extends F{constructor(t="Hello!",i="12px sans-serif",h="red",s=0,n=0){super();Object.assign(this,{content:t,font:i,fillStyle:h,x:s,y:n}),this.textBaseline="top",this.strokeText="none"}draw(t){t.font=this.font,t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.fillStyle=this.fillStyle,this.width===0&&(this.width=t.measureText(this.content).width),this.height===0&&(this.height=t.measureText("M").width),t.translate(-this.width*this.pivotX,-this.height*this.pivotY),t.textBaseline=this.textBaseline,t.fillText(this.content,0,0),this.strokeText!=="none"&&t.strokeText()}}S.load(["src/assets/link_master.json","src/assets/bg.json","src/assets/enemies.json","src/assets/blob.json","src/assets/ammo.json","src/assets/customLink.json","src/assets/silver.ttf"]).then(()=>Et());function Et(){console.log(S);const e=ct("app");e.ctx;let t=0,i=0;const h=new F;[h.width,h.height]=[e.width,e.height],pt(h).observe(e);const s=document.querySelector(".modal");s.addEventListener("click",()=>{s.classList.add("hidden"),j()});const n=new M(S["outdoors.png"]);n.scale=1;const o=new Mt(S.customLink,16,26);let a=new Ct("","12px puzzler","black",8,8);const l=new U;[n,o,l,a].forEach(f=>h.addChild(f));let r=[],d=48,m=150;for(let f=0;f<6;f++){const b=new At(kt(S)("pinkblob"),d*f+m,T(0,e.height-20));r=[...r,b],h.addChild(b)}const y=new U(r);let v=[];const u=()=>Ht(h)(S.ammo)({scale:h.children[1].scale}),c=(f,b)=>{c.reloading||(Yt(f,b,0,20,v,u),c.reloading=!0)};console.log(h.children);let g={kb:{dir:p.None,left:new D(["ArrowLeft","KeyA"],function(){g.kb.dir|=p.Left,o.facing="Left"},function(){g.kb.dir&=~p.Left}),up:new D(["ArrowUp","KeyW"],function(){g.kb.dir|=p.Up,o.facing="Up"},function(){g.kb.dir&=~p.Up}),right:new D(["ArrowRight","KeyD"],function(){g.kb.dir|=p.Right,o.facing="Right"},function(){g.kb.dir&=~p.Right}),down:new D(["ArrowDown","KeyS"],function(){g.kb.dir|=p.Down,o.facing="Down"},function(){g.kb.dir&=~p.Down})},mouse:{}};const k=Ft(e);k.press=f=>{g.mouse.button=f.button,c.reloading&&g.mouse.button===2&&g.mouse.button,f.button===2&&!c.reloading&&(c(o,Math.atan2(k.centerY-o.y,k.centerX-o.x)),Xt(600).then(()=>c.reloading=!1)),g.mouse.atan2=Math.atan2(k.centerY-o.y,k.centerX-o.x)},k.release=f=>{g.mouse.button=void 0};const ht=new Set(["Space"]);addEventListener("contextmenu",f=>f.preventDefault()),addEventListener("keypress",f=>{ht.has(f.code)&&f.preventDefault});function at(){h.putCenter(n),o.update(g),r.forEach(f=>f.act()),z(y,h.localBounds),z(o,h.localBounds),Q(o.attackRange,r,!0,!0,null,(f,b)=>{o.state==="attack"&&(b.hp-=2),console.log(b)}),r=r.filter(f=>f.hp<1?(Z(f),!1):!0),v=v.filter(f=>{let b=Q(f,r,!0,!0,null,(Pt,I)=>{I.hp-=1,console.log(I)});return b&&console.log(b),f.x+=f.vx,f.y+=f.vy,Tt(f,h.localBounds)?(Z(f),!1):!0})}tt(h,e);function j(f){for(f||(f=0),i+=f-t;i>=et;)at(),i-=et;tt(h,e),t=f,requestAnimationFrame(j)}}
