var E=Object.defineProperty;var H=(i,t,s)=>t in i?E(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s;var F=(i,t,s)=>(H(i,typeof t!="symbol"?t+"":t,s),s),X=(i,t,s)=>{if(!t.has(i))throw TypeError("Cannot "+s)};var x=(i,t,s)=>(X(i,t,"read from private field"),s?s.call(i):t.get(i)),p=(i,t,s)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,s)},v=(i,t,s,h)=>(X(i,t,"write to private field"),h?h.call(i,s):t.set(i,s),s);import"https://cdn.skypack.dev/normalizecss";const C=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))h(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&h(r)}).observe(document,{childList:!0,subtree:!0});function s(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerpolicy&&(a.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?a.credentials="include":e.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function h(e){if(e.ep)return;e.ep=!0;const a=s(e);fetch(e.href,a)}};C();let b={toLoad:0,loaded:0,load(i){return new Promise(t=>{const s=()=>{this.loaded+=1,this.toLoad===this.loaded&&(this.toLoad=0,this.loaded=0,t())};this.toLoad=i.length,i.forEach(h=>{h.split(".").pop()==="json"&&this.loadJson(h,s)})})},async loadJson(i,t){const h=await(await fetch(i)).json();let e=/(?<=\/)\w+\.\w+$/.exec(i)[0];this[e]=h,h.meta.frameTags?this.processFrameTags(e,h,t):h.frames?this.processFrames(h,t):t()},processFrameTags(i,t,s){const h=i.split(".").shift(),e=t.meta.image,a=Object.keys(t.frames),r=()=>{var l;this[e]=n,this[h]={image:this[e],frameTags:{}};for(let o of t.meta.frameTags){let{name:d,from:f,to:w}=o,u=f+0;((l=this[h].frameTags)==null?void 0:l[d])||(this[h].frameTags[d]=[]);do this[h].frameTags[d].push(t.frames[a[u]].frame),u++;while(u<=w)}s()};let n=new Image;n.addEventListener("load",r),n.src=e},processFrames(i,t){const s=i.meta.image,h=()=>{this[s]=e,Object.keys(i.frames).forEach(a=>{this[a]=i.frames[a],this[a].source=this[s]}),t()};let e=new Image;e.addEventListener("load",h),e.src=s}};var g;class T{constructor(){p(this,g,void 0);F(this,"diameter");F(this,"radius");this.x=0,this.y=0,this.width=0,this.height=0,this.pivotX=.5,this.pivotY=.5,this.rotation=0,this.alpha=1,this.visible=!0,this.scaleX=1,this.scaleY=1,this.vX=0,this.vY=0,this.accelerationX=0,this.accelerationY=0,this.frictionX=0,this.frictionY=0,this.gravity=0,this.mass=0,v(this,g,!1),this.shadow=!1,this.shadowColor="rgba(100, 100, 100, 0.5)",this.shadowOffsetX=3,this.shadowOffsetY=3,this.shadowBlur=3,this.parent=void 0,this.children=[]}get halfWidth(){return this.width*.5}get halfHeight(){return this.height*.5}get centerX(){return this.x+this.halfWidth}get centerY(){return this.y+this.halfHeight}get position(){return{x:this.x,y:this.y}}setScale(t,s=void 0){if(!s&&this.scaleX!==this.scaleY){console.log("scale X and Y are not equal, please supply two values");return}this.scaleX=t,this.scaleY=s||t}setPosition(t,s){[this.x,this.y]=[t,s]}get gx(){return this.parent?this.x+this.parent.gx:this.x}get gy(){return this.parent?this.y+this.parent.gy:this.y}putCenter(t,s=0,h=0){let e=this;t.x=e.x+e.halfWidth-t.halfWidth+s,t.y=e.y+e.halfHeight-t.halfHeight+h}addChild(t){t.parent&&t.parent.removeChild(t),t.parent=this,this.children.push(t)}removeChild(t){if(t.parent===this)this.children.splice(this.children.indexOf(t),1);else throw new Error(t+"is not a child of "+this)}get localBounds(){return{x:0,y:0,width:this.width,height:this.height}}get globalBounds(){return{x:this.gx,y:this.gy,width:this.gx+this.width,height:this.gy+this.height}}get circular(){return x(this,g)}set circular(t){t===!0&&x(this,g)===!1&&(Object.defineProperties(this,{diameter:{get(){return this.width},set(s){this.width=s,this.height=s},enumerable:!0,configurable:!0},radius:{get(){return this.halfWidth},set(s){this.width=s*2,this.height=s*2},enumerable:!0,configurable:!0}}),v(this,g,!0)),t===!1&&x(this,g)===!0&&(delete this.diameter,delete this.radius,v(this,g,!1))}}g=new WeakMap;class D extends T{constructor(t=32,s=32,h="hotpink",e="none",a=0,r=0,n=0){super();Object.assign(this,{width:t,height:s,fillStyle:h,strokeStyle:e,lineWidth:a,x:r,y:n}),this.mask=!1}draw(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.fillStyle=this.fillStyle,t.beginPath(),t.rect(-this.width*this.pivotX,-this.height*this.pivotY,this.width,this.height),this.strokeStyle!=="none"&&t.stroke(),this.fillStyle!=="none"&&t.fill(),this.mask&&this.mask===!0&&t.clip()}}class Y extends T{constructor(t,s=0,h=0){super();Object.assign(this,{x:s,y:h}),t instanceof Image&&this.createFromImage(t),t.frameTags&&this.createFromFrameTags(t),t.frame&&this.createFromAtlas(t)}createFromImage(t){this.source=t,this.sourceX=0,this.sourceY=0,this.width=t.width,this.height=t.height,this.sourceWidth=t.width,this.sourceHeight=t.height}createFromAtlas(t){this.tilesetFrame=t,this.source=this.tilesetFrame.source,this.sourceX=this.tilesetFrame.frame.x,this.sourceY=this.tilesetFrame.frame.y,this.width=this.tilesetFrame.frame.w,this.height=this.tilesetFrame.frame.h,this.sourceWidth=this.tilesetFrame.frame.w,this.sourceHeight=this.tilesetFrame.frame.h}createFromFrameTags(t){this.source=t.image,this.frameTags=t.frameTags;const s=Object.keys(this.frameTags)[0];this.sourceX=this.frameTags[s][0].x,this.sourceY=this.frameTags[s][0].y,this.width=this.sourceWidth=this.frameTags[s][0].w,this.height=this.sourceHeight=this.frameTags[s][0].h}draw(t){t.drawImage(this.source,this.sourceX,this.sourceY,this.sourceWidth,this.sourceHeight,-this.width*this.pivotX,-this.height*this.pivotY,this.width,this.height)}}class j extends Y{constructor(t,s,h){super(t);this.hitbox=new D(s,h,"none","none"),this.addChild(this.hitbox),this.putCenter(this.hitbox),Object.assign(this,{x:120,y:120,shadow:!0})}beAhero(){console.log("ima hero")}}let k=0;function A(i="canvas",t=256,s=256){const h=document.createElement("canvas");return++k,i==="canvas"?h.classList.add(`${i}${k}`):h.id=i,h.width=t,h.height=s,document.body.insertBefore(h,document.querySelectorAll("body > :last-child")[0]),h.ctx=h.getContext("2d"),h}function I(i,t,s=!1){let h=t.x,e=t.y,a=t.width,r=t.height,n,l=.96,o={};i.hitbox?(o.x=i.hitbox.gx,o.y=i.hitbox.gy,o.width=i.hitbox.width,o.height=i.hitbox.height):(o.x=i.x,o.y=i.y,o.width=i.width,o.height=i.height);let d=i.hitbox?(i.width-i.hitbox.width)/2:0,f=i.hitbox?(i.height-i.hitbox.height)/2:0;return o.x<0&&(s&&(i.vx*=-l),i.mass&&(i.vx/=i.mass),i.x=h-d,n="left"),o.y<e&&(s&&(i.vy*=-l),i.mass&&(i.vy/=i.mass),i.y=e-f,n="top"),o.x+o.width>a&&(s&&(o.vx*=-l),i.mass&&(i.vx/=i.mass),i.x=a-i.width+d,n="right"),o.y+o.height>r&&(s&&(i.vy*=-l),i.mass&&(i.vy/=i.mass),i.y=r-i.height+f,n="bottom"),n}const P=i=>new ResizeObserver(K(R(i))),K=i=>t=>{t.forEach(s=>{let h=s.target;s===t[0]&&(h=new Proxy(h,i));let{width:e,height:a}=s.contentRect;Object.assign(h,{width:e,height:a})})},R=i=>({set(t,s,h){const e=t.width;if((s==="width"||s==="height")&&(i[s]=h),s==="width"){const a=i.children,r=a[0];let[,...n]=a,l=h/e;const o=r.height/r.width;r.width=i.width,r.height=i.width*o,e!==256&&n.forEach(d=>{let{x:f,y:w,scaleX:u}=d;d.setPosition(f*l,w*l),d.setScale(u*l)})}return Reflect.set(t,s,h)}});class O{constructor(t,s=()=>console.log(`${t} pressed`),h=()=>console.log(`${t} released`)){this.code=t,this.isDown=!1,this.isUp=!0,this.press=s,this.release=h,window.addEventListener("keydown",this.downHandler.bind(this)),window.addEventListener("keyup",this.upHandler.bind(this))}downHandler(t){t.code===this.code&&(this.press(),this.isDown=!0,this.isUp=!1),t.preventDefault()}upHandler(t){t.code===this.code&&(this.release(),this.isUp=!0,this.isDown=!1),t.preventDefault()}}const m={None:0,Left:1<<0,Right:1<<1,Up:1<<2,Down:1<<3};function W(i,t){let s=t.ctx;s.clearRect(0,0,t.width,t.height),i.children.forEach(e=>{h(e)});function h(e){e.visible&&e.gx<t.width+e.width&&e.gx+e.width>=-e.width&&e.gy<t.height+e.height&&e.gy+e.height>=-e.height&&(s.save(),s.translate(e.x+e.width*e.pivotX,e.y+e.height*e.pivotY),s.rotate(e.rotation),s.globalAlpha=e.alpha*e.parent.alpha,s.scale(e.scaleX,e.scaleY),e.draw&&e.draw(s),e.children&&e.children.length>0&&(s.translate(-e.width*e.pivotX,-e.height*e.pivotY),e.children.forEach(a=>{h(a)})),s.restore())}}function N(i,t,s,{timestamp:h,elapsed:e,totalElapsed:a,framesDrawn:r,updateCycles:n}){t.font="13px sans-serif",t.fillStyle="rgba(255, 255, 255, 50%)",t.fillRect(i-240,20,200,110),t.fillStyle="rgba(0,0,0,100%)",t.fillText(`linkVelocity:	 ${(s.vX+s.vY).toFixed(2)}, x: 	${Math.round(s.x)},y: 	 ${Math.round(s.y)}`,i-237,0+125),t.fillText(`timestamp:	 ${h.toFixed(0).padStart(6)}`,i-237,0+35),t.fillText(`elapsed:	 ${e.toFixed(2).padStart(6)}`,i-237,0+50),t.fillText(`totalElapsed:	 ${a.toFixed(2).padStart(6)}`,i-237,0+65),t.fillText(`framesDrawn:	 ${r.toString().padStart(6)}`,i-237,0+80),t.fillText(`fps:	 ${(1e3*r/h).toFixed(2).padStart(6)} updates/sec: 	${(1e3*n/h).toFixed(2).padStart(6)}`,i-237,0+110),t.fillText(`updatecycles:	 ${n.toString().padStart(6)}`,i-237,0+95)}b.load(["src/assets/link_master.json","src/assets/bg.json","src/assets/enemies.json"]).then(()=>U());function U(){console.log(b);let i=m.None;[["KeyA","Left"],["KeyD","Right"],["KeyW","Up"],["KeyS","Down"]].map(c=>{let[y,S]=c,L=`Arrow${S}`;return[y,L].map($=>new O(`${$}`,()=>i|=m[S],()=>i&=~m[S]))}),new O("KeyV",()=>console.log(e.x,e.y),()=>console.log(e.hitbox.gx,e.hitbox.gy));const t=A("app"),s=new T;[s.width,s.height]=[t.width,t.height],P(s).observe(t);const h=new Y(b["outdoors.png"]),e=new j(b.link_master,16,26);e.setScale(1.2),[h,e].forEach(c=>s.addChild(c));let a=30,r=1e3/a,n=t.ctx,l=0,o=0,d=0,f=0;function w(){s.putCenter(h);let c=.75,y=6;e.accelerationX=e.accelerationY=1.5,Math.abs(e.vX+e.vY)>=y||(i&m.Up&&(e.vY-=e.accelerationY),i&m.Down&&(e.vY+=e.accelerationY),i&m.Left&&(e.vX-=e.accelerationX),i&m.Right&&(e.vX+=e.accelerationX)),e.vY*=c,e.vX*=c,I(e,s.localBounds),e.x=e.x+e.vX,e.y=e.y+e.vY,++d}u();function u(c){c||(c=0);let y=c-l;for(f+=y;f>=r;)w(),f-=r;W(s,t),++o,N(window.innerWidth,n,e,{timestamp:c,elapsed:y,totalElapsed:f,framesDrawn:o,updateCycles:d}),l=c,requestAnimationFrame(u)}}
